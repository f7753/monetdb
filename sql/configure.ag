dnl Process this file with autoconf to produce a configure script.
AC_INIT(src/common/sql.h)
AC_CONFIG_AUX_DIR(conf)

dnl ----------------------
AM_INIT_AUTOMAKE("sql", 2.0)
AM_CONFIG_HEADER(sql_config.h:conf/config.h.in)
AC_CANONICAL_HOST

HOST=[$host]
AC_DEFINE_UNQUOTED(HOST, "$HOST", [Host identifier])

dnl Check for Monet
AM_MONET_COMPILER()
AM_MONET_TOOLS()
AM_MONET_OPTIONS()
AM_MONET_LIBS()
AM_MONET_CLIENT()
if test "x$have_monet" != xyes; then
	AC_MSG_ERROR(Monet is not found.)
fi

dnl libodbc
have_odbc=auto
ODBC_LIBS=""
ODBC_INCS=""
AC_ARG_WITH(odbc,
[  --with-odbc=DIR     odbc library is installed in DIR], 
	[have_odbc="$withval"])
if test "x$have_odbc" != xno; then
  if test "x$have_odbc" != xauto; then
    ODBC_LIBS="-L$withval/lib"
    ODBC_INCS="-I$withval/include"
  fi

  save_CPPFLAGS="$CPPFLAGS"
  CPPFLAGS="$CPPFLAGS $ODBC_INCS"
  AC_CHECK_HEADERS(sql.h)
  CPPFLAGS="$save_CPPFLAGS"

  save_LDFLAGS="$LDFLAGS"
  LDFLAGS="$ODBC_LIBS $LDFLAGS"
  AC_CHECK_LIB(odbc, SQLConnect, 
	[ ODBC_LIBS="$ODBC_LIBS -lodbc" 
          AC_DEFINE(HAVE_LIBODBC) 
	  have_odbc=yes ]
	, have_odbc=no )
  LDFLAGS="$save_LDFLAGS"

  if test "x$have_odbc" != xyes; then
    ODBC_LIBS=""
    ODBC_INCS=""
  fi
fi
AM_CONDITIONAL(HAVE_ODBC,test "x$have_odbc" = xyes)
AC_SUBST(ODBC_LIBS)
AC_SUBST(ODBC_INCS)

dnl static or shared linking
SHARED_LIBS=''
[
if [ "$enable_static" = "yes" ]; then
	CFLAGS="$CFLAGS -DSTATIC"
	SHARED_LIBS='$(smallTOC_SHARED_LIBS)'
	case "$host_os" in
	*)	CFLAGS="$CFLAGS -DsmallTOC -DSQLmodules";;
	esac
	if test "x$GCC" != xyes; then
		case "$host_os" in
		irix*)	SHARED_LIBS="$SHARED_LIBS -lm";;
		esac
	fi
fi
]
AC_SUBST(SHARED_LIBS)
AM_CONDITIONAL(LINK_STATIC,test "x$enable_static" = xyes)
