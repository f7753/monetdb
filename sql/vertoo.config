# Vertoo v0.8 config file, see http://vertoo.sourceforge.net/

registry.registerScheme('jdbc_full', '%major.%minor (%suffix)')
registry.registerScheme('winrc', '%major,%minor,%release,0')
registry.registerScheme('sql', '%major.%minor.%release')
registry.registerScheme('monetdb', '%major.%minor.%release')

# %v - unadorned version number
# %q - version number surrounded by single quotes
# %Q - version number surrounded by double quotes

JDBC = ModuleInfo('jdbc', [
  FileInfo("src/jdbc/build.properties", [
    AnchorInfo('simple', 1,
      arguments(pattern="JDBC_MAJOR=%v", format="%major")),
    AnchorInfo('simple', 1,
      arguments(pattern="JDBC_MINOR=%v", format="%minor")),
    AnchorInfo('simple', 1,
      arguments(pattern="JDBC_VER_SUFFIX=%v", format="%suffix")),
    ]),
  FileInfo("configure.ag", [
    AnchorInfo('simple', 1,
      arguments(pattern="JDBC_MAJOR=%v", format="%major")),
    AnchorInfo('simple', 1,
      arguments(pattern="JDBC_MINOR=%v", format="%minor")),
    AnchorInfo('simple', 1,
      arguments(pattern="JDBC_VER_SUFFIX=%Q", format="%suffix")),
    ]),
  FileInfo("NT/configure.py", [
    AnchorInfo('simple', 1,
      arguments(pattern="'@JDBC_MAJOR@',        %q", format="%major")),
    AnchorInfo('simple', 1,
      arguments(pattern="'@JDBC_MINOR@',        %q", format="%minor")),
    AnchorInfo('simple', 1,
      arguments(pattern="'@JDBC_VER_SUFFIX@',   %q", format="%suffix")),
    ]),
  FileInfo("src/jdbc/release.txt", [
    AnchorInfo('simple', 1,
      arguments(pattern="MonetDB JDBC driver version %v", format="@jdbc_full")),
    ]),
  ])

SQL = ModuleInfo('sql', [
  FileInfo("src/odbc/winsetup/MonetDB-ODBC-Installer/MonetDB-ODBC-Installer.vdproj", [
    AnchorInfo('simple', 1,
      arguments(pattern='"ProductVersion" = "8:%v"', format="@sql")),
    ]),
  FileInfo("src/odbc/winsetup/setup.rc", [
    AnchorInfo('simple', 1,
      arguments(pattern="FILEVERSION %v", format="@winrc")),
    AnchorInfo('simple', 1,
      arguments(pattern="PRODUCTVERSION %v", format="@winrc")),
    AnchorInfo('simple', 1,
      arguments(pattern='VALUE "FileVersion", "%v\\0"', format="@sql")),
    AnchorInfo('simple', 1,
      arguments(pattern='VALUE "ProductVersion", "%v\\0"', format="@sql")),
    ]),
  FileInfo("NT/configure.py", [
    AnchorInfo('simple', 1,
      arguments(pattern="'@VERSION@',           %Q", format="@sql")),
    ]),
  FileInfo("configure.ag", [
    AnchorInfo('simple', 1,
      arguments(pattern='"sql", %v,', format="@sql")),
    ]),
  FileInfo("VERSION", [
    AnchorInfo('simple', 1,
      arguments(pattern="%v", format="@sql")),
    ]),
  ])

MONETDB = ModuleInfo('MonetDB', [
  FileInfo("configure.ag", [
    AnchorInfo('simple', 1,
      arguments(pattern="req_monetdb_ver=%q", format="@monetdb")),
    ]),
  FileInfo("MonetDB-SQL.pc.in", [
    AnchorInfo('simple', 1,
      arguments(pattern="Requires: MonetDB >= %v", format="@monetdb")),
    ]),
  ])

modules = [JDBC,SQL,MONETDB]
