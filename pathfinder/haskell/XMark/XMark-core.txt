-- Q1.Return the name of the person with ID `person0'
--    registered in North America.

for $b in fn:doc("auction.xml")/site/people/person
return
    if fn:data ($b/@id/text()) = "person0" 
    then $b/name/text()
    else ()

-- Q2. Return the initial increases of all open auctions.

for $b in fn:doc("auction.xml")/site/open_auctions/open_auction
return element {"increase"} 
               { for $x at $p in $b/bidder
                 return if $p = 1 then $x/increase/text()
                        else ()
               }

-- Q5.  How many sold items cost more than 40?

fn:count(for $i in fn:doc("auction.xml")/site/closed_auctions/closed_auction
         return if xs:int(fn:data($i/price/text())) > 40
                then $i/price
                else ())

-- Q6. How many items are listed on all continents?

for $b in fn:doc("auction.xml")/site/regions
return fn:count($b//item)

-- Q7. How many pieces of prose are in our database?

for $p in fn:doc("auction.xml")/site
return fn:count($p//description) +
       fn:count($p//annotation)  +
       fn:count($p//email)

-- Q8. List the names of persons and the number of items they bought.
--     (joins person, closed\_auction)}
for $p in fn:doc("auction.xml")/site/people/person
return let $a := for $t in fn:doc("auction.xml")/site/closed_auctions/closed_auction
                 return if fn:data($t/buyer/person/text()) = fn:data($p/id/text())
                        then $t
                        else ()
       return element {"item"} { element {"person"} { $p/name/text() },
                                 text { xs:string(fn:count($a)) }
                               }

-- Q13. List the names of items registered in Australia along with 
--      their descriptions.

for $i in fn:doc("auction.xml")/site/regions/australia/item
return element {"item"} { element {"name"} { $i/name/text() },
                          $i/description
                        }

-- Q17. Which persons don't have a homepage?

for $p in fn:doc("auction.xml")/site/people/person
return if fn:empty ($p/homepage/text())
       then element {"person"} { $p/name/text() }
       else ()

-- Q18.Convert the currency of the reserve of all open auctions to 
--     another currency.

define function convert ($v) { 2 * $v }

for $i in fn:doc("auction.xml")/site/open_auctions/open_auction
return convert(xs:int(fn:data($i/reserve/text())))

