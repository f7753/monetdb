xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (bib),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($b),
                       locpath (step (child, namet (book)),
                         locpath (step (child, namet (bib)),
                           fun_ref (document,
                             args
                               (lit_str
                                  ("http://www.bn.com/bib.xml"),
                               nil ()))))), nil ()),
                 and
                   (eq
                      (locpath
                         (step (child, namet (publisher)),
                         varref ($b)),
                      lit_str ("Addison-Wesley")),
                   gt
                     (locpath
                        (step (attribute, namet (year)),
                        varref ($b)), lit_int (1991))),
                 nil (),
                 elem (tag (book),
                   exprseq
                     (attr (tag (year),
                        exprseq
                          (exprseq
                             (locpath
                                (step (attribute,
                                   namet (year)),
                                varref ($b)), empty-seq ()),
                          empty-seq ())),
                     exprseq (empty-seq (),
                       exprseq
                         (exprseq
                            (locpath
                               (step (child, namet (title)),
                               varref ($b)), empty-seq ()),
                         exprseq (empty-seq (),
                           empty-seq ())))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (results),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($b),
                       locpath (step (child, namet (book)),
                         locpath (step (child, namet (bib)),
                           fun_ref (document,
                             args
                               (lit_str
                                  ("http://www.bn.com/bib.xml"),
                               nil ()))))),
                    binds
                      (bind (nil (), nil (), varref ($t),
                         locpath
                           (step (child, namet (title)),
                           varref ($b))),
                      binds
                        (bind (nil (), nil (), varref ($a),
                           locpath
                             (step (child, namet (author)),
                             varref ($b))), nil ()))),
                 nil (), nil (),
                 elem (tag (result),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq (varref ($t), empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (exprseq (varref ($a),
                              empty-seq ()),
                           exprseq (empty-seq (),
                             empty-seq ()))))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (results),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($b),
                       locpath (step (child, namet (book)),
                         locpath (step (child, namet (bib)),
                           fun_ref (document,
                             args
                               (lit_str
                                  ("http://www.bn.com/bib.xml"),
                               nil ()))))), nil ()), nil (),
                 nil (),
                 elem (tag (result),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq
                          (locpath
                             (step (child, namet (title)),
                             varref ($b)), empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (exprseq
                              (locpath
                                 (step (child,
                                    namet (author)),
                                 varref ($b)),
                              empty-seq ()),
                           exprseq (empty-seq (),
                             empty-seq ()))))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (results),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($a),
                       fun_ref (distinct-values,
                         args
                           (locpath
                              (step (child, namet (author)),
                              locpath
                                (step (descendant-or-self,
                                   kindt (node, nil ())),
                                fun_ref (document,
                                  args
                                    (lit_str
                                       ("http://www.bn.com/bib.xml"),
                                    nil ())))), nil ()))),
                    nil ()), nil (), nil (),
                 elem (tag (result),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq (varref ($a), empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (exprseq
                              (flwr
                                 (binds
                                    (bind (nil (), nil (),
                                       varref ($b),
                                       locpath
                                         (step (child,
                                            namet (book)),
                                         locpath
                                           (step (child,
                                              namet (bib)),
                                           fun_ref
                                             (document,
                                             args
                                               (lit_str
                                                  ("http://www.bn.com/bib.xml"),
                                               nil ()))))),
                                    nil ()),
                                 some
                                   (binds
                                      (bind (nil (), nil (),
                                         varref ($ba),
                                         locpath
                                           (step (child,
                                              namet (author)),
                                           varref ($b))),
                                      nil ()),
                                   fun_ref (deep-equal,
                                     args (varref ($ba),
                                       args (varref ($a),
                                         nil ())))), nil (),
                                 locpath
                                   (step (child,
                                      namet (title)),
                                   varref ($b))),
                              empty-seq ()),
                           exprseq (empty-seq (),
                             empty-seq ()))))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (books-with-prices),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($b),
                       locpath (step (child, namet (book)),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (document,
                             args
                               (lit_str
                                  ("http://www.bn.com/bib.xml"),
                               nil ()))))),
                    binds
                      (bind (nil (), nil (), varref ($a),
                         locpath
                           (step (child, namet (entry)),
                           locpath
                             (step (descendant-or-self,
                                kindt (node, nil ())),
                             fun_ref (document,
                               args
                                 (lit_str
                                    ("http://www.amazon.com/reviews.xml"),
                                 nil ()))))), nil ())),
                 eq
                   (locpath (step (child, namet (title)),
                      varref ($b)),
                   locpath (step (child, namet (title)),
                     varref ($a))), nil (),
                 elem (tag (book-with-prices),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq
                          (locpath
                             (step (child, namet (title)),
                             varref ($b)), empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (elem (tag (price-amazon),
                              exprseq
                                (exprseq
                                   (locpath
                                      (step (child,
                                         kindt (text,
                                           nil ())),
                                      locpath
                                        (step (child,
                                           namet (price)),
                                        varref ($a))),
                                   empty-seq ()),
                                empty-seq ())),
                           exprseq (empty-seq (),
                             exprseq
                               (elem (tag (price-bn),
                                  exprseq
                                    (exprseq
                                       (locpath
                                          (step (child,
                                             kindt (text,
                                               nil ())),
                                          locpath
                                            (step (child,
                                               namet (price)),
                                            varref ($b))),
                                       empty-seq ()),
                                    empty-seq ())),
                               exprseq (empty-seq (),
                                 empty-seq ()))))))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (bib),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($b),
                       locpath (step (child, namet (book)),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (document,
                             args
                               (lit_str
                                  ("http://www.bn.com/bib.xml"),
                               nil ()))))), nil ()),
                 gt
                   (fun_ref (count,
                      args
                        (locpath
                           (step (child, namet (author)),
                           varref ($b)), nil ())),
                   lit_int (0)), nil (),
                 elem (tag (book),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq
                          (locpath
                             (step (child, namet (title)),
                             varref ($b)), empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (exprseq
                              (flwr
                                 (binds
                                    (bind (nil (), nil (),
                                       varref ($a),
                                       locpath
                                         (pred
                                            (locpath
                                               (step (child,
                                                  namet
                                                    (author)),
                                               dot ()),
                                            le
                                              (fun_ref
                                                 (position,
                                                 nil ()),
                                              lit_int (2))),
                                         varref ($b))),
                                    nil ()), nil (), nil (),
                                 varref ($a)),
                              empty-seq ()),
                           exprseq (empty-seq (),
                             exprseq
                               (exprseq
                                  (if
                                     (gt
                                        (fun_ref (count,
                                           args
                                             (locpath
                                                (step
                                                   (child,
                                                   namet
                                                     (author)),
                                                varref ($b)),
                                             nil ())),
                                        lit_int (2)),
                                     elem (tag (et-al),
                                       empty-seq ()),
                                     empty-seq ()),
                                  empty-seq ()),
                               exprseq (empty-seq (),
                                 empty-seq ()))))))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (bib),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($b),
                       locpath (step (child, namet (book)),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (document,
                             args
                               (lit_str
                                  ("http://www.bn.com/bib.xml"),
                               nil ()))))), nil ()),
                 and
                   (eq
                      (locpath
                         (step (child, namet (publisher)),
                         varref ($b)),
                      lit_str ("Addison-Wesley")),
                   gt
                     (locpath
                        (step (attribute, namet (year)),
                        varref ($b)), lit_int (1991))),
                 orderby (unstable,
                   orderspecs (asc, empty least, default,
                     locpath (step (child, namet (title)),
                       varref ($b)), nil ())),
                 elem (tag (book),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq
                          (locpath
                             (step (attribute,
                                namet (year)), varref ($b)),
                          empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (exprseq
                              (locpath
                                 (step (child,
                                    namet (title)),
                                 varref ($b)),
                              empty-seq ()),
                           exprseq (empty-seq (),
                             empty-seq ()))))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (flwr
       (binds
          (bind (nil (), nil (), varref ($b),
             locpath (step (child, namet (book)),
               locpath
                 (step (descendant-or-self,
                    kindt (node, nil ())),
                 fun_ref (document,
                   args
                     (lit_str ("http://www.bn.com/bib.xml"),
                     nil ()))))),
          binds
            (let (nil (), varref ($e),
               locpath
                 (pred
                    (locpath (step (child, namet (*:*)),
                       dot ()),
                    and
                      (fun_ref (contains,
                         args
                           (fun_ref (string,
                              args
                                (locpath
                                   (step (self,
                                      kindt (node, nil ())),
                                   dot ()), nil ())),
                           args (lit_str ("Suciu"), nil ()))),
                      fun_ref (ends-with,
                        args
                          (fun_ref (local-name,
                             args
                               (locpath
                                  (step (self,
                                     kindt (node, nil ())),
                                  dot ()), nil ())),
                          args (lit_str ("or"), nil ()))))),
                 varref ($b))), nil ())),
       fun_ref (exists, args (varref ($e), nil ())), nil (),
       elem (tag (book),
         exprseq (empty-seq (),
           exprseq
             (exprseq
                (locpath (step (child, namet (title)),
                   varref ($b)), empty-seq ()),
             exprseq (empty-seq (),
               exprseq (exprseq (varref ($e), empty-seq ()),
                 exprseq (empty-seq (), empty-seq ()))))))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (results),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($t),
                       locpath (step (child, namet (title)),
                         locpath
                           (exprseq
                              (union
                                 (locpath
                                    (step (child,
                                       namet (chapter)),
                                    dot ()),
                                 locpath
                                   (step (child,
                                      namet (section)),
                                   dot ())), empty-seq ()),
                           locpath
                             (step (descendant-or-self,
                                kindt (node, nil ())),
                             fun_ref (document,
                               args (lit_str ("books.xml"),
                                 nil ())))))), nil ()),
                 fun_ref (contains,
                   args
                     (locpath
                        (step (child, kindt (text, nil ())),
                        varref ($t)),
                     args (lit_str ("XML"), nil ()))),
                 nil (), varref ($t)), empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (results),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (let (nil (), varref ($doc),
                       fun_ref (document,
                         args (lit_str ("prices.xml"),
                           nil ()))),
                    binds
                      (bind (nil (), nil (), varref ($t),
                         fun_ref (distinct-values,
                           args
                             (locpath
                                (step (child,
                                   namet (title)),
                                locpath
                                  (step (child,
                                     namet (book)),
                                  locpath
                                    (step
                                       (descendant-or-self,
                                       kindt (node, nil ())),
                                    varref ($doc)))),
                             nil ()))),
                      binds
                        (let (nil (), varref ($p),
                           flwr
                             (binds
                                (bind (nil (), nil (),
                                   varref ($x),
                                   locpath
                                     (step (child,
                                        namet (price)),
                                     locpath
                                       (pred
                                          (locpath
                                             (step (child,
                                                namet (book)),
                                             dot ()),
                                          eq
                                            (locpath
                                               (step (child,
                                                  namet
                                                    (title)),
                                               dot ()),
                                            varref ($t))),
                                       locpath
                                         (step
                                            (descendant-or-self,
                                            kindt (node,
                                              nil ())),
                                         varref ($doc))))),
                                nil ()), nil (), nil (),
                             fun_ref (decimal,
                               args (varref ($x), nil ())))),
                        nil ()))), nil (), nil (),
                 elem (tag (minprice),
                   exprseq
                     (attr (tag (title),
                        exprseq
                          (exprseq
                             (locpath
                                (step (child,
                                   kindt (text, nil ())),
                                varref ($t)), empty-seq ()),
                          empty-seq ())),
                     exprseq (empty-seq (),
                       exprseq
                         (elem (tag (price),
                            exprseq
                              (exprseq
                                 (fun_ref (min,
                                    args (varref ($p),
                                      nil ())),
                                 empty-seq ()),
                              empty-seq ())),
                         exprseq (empty-seq (),
                           empty-seq ())))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (bib),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($b),
                       locpath
                         (pred
                            (locpath
                               (step (child, namet (book)),
                               dot ()),
                            locpath
                              (step (child, namet (author)),
                              dot ())),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (document,
                             args
                               (lit_str
                                  ("http://www.bn.com/bib.xml"),
                               nil ()))))), nil ()), nil (),
                 nil (),
                 elem (tag (book),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq
                          (locpath
                             (step (child, namet (title)),
                             varref ($b)), empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (exprseq
                              (locpath
                                 (step (child,
                                    namet (author)),
                                 varref ($b)),
                              empty-seq ()),
                           exprseq (empty-seq (),
                             empty-seq ()))))))),
              empty-seq ()),
           exprseq (empty-seq (),
             exprseq
               (exprseq
                  (flwr
                     (binds
                        (bind (nil (), nil (), varref ($b),
                           locpath
                             (pred
                                (locpath
                                   (step (child,
                                      namet (book)),
                                   dot ()),
                                locpath
                                  (step (child,
                                     namet (editor)),
                                  dot ())),
                             locpath
                               (step (descendant-or-self,
                                  kindt (node, nil ())),
                               fun_ref (document,
                                 args
                                   (lit_str
                                      ("http://www.bn.com/bib.xml"),
                                   nil ()))))), nil ()),
                     nil (), nil (),
                     elem (tag (reference),
                       exprseq (empty-seq (),
                         exprseq
                           (exprseq
                              (locpath
                                 (step (child,
                                    namet (title)),
                                 varref ($b)),
                              empty-seq ()),
                           exprseq (empty-seq (),
                             exprseq
                               (exprseq
                                  (locpath
                                     (step (child,
                                        namet (affiliation)),
                                     locpath
                                       (step (child,
                                          namet (editor)),
                                       varref ($b))),
                                  empty-seq ()),
                               exprseq (empty-seq (),
                                 empty-seq ()))))))),
                  empty-seq ()),
               exprseq (empty-seq (), empty-seq ())))))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (bib),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($book1),
                       locpath (step (child, namet (book)),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (document,
                             args
                               (lit_str
                                  ("http://www.bn.com/bib.xml"),
                               nil ()))))),
                    binds
                      (let (nil (), varref ($aut1),
                         flwr
                           (binds
                              (bind (nil (), nil (),
                                 varref ($a),
                                 locpath
                                   (step (child,
                                      namet (author)),
                                   varref ($book1))),
                              nil ()), nil (),
                           orderby (unstable,
                             orderspecs
                               (asc, empty least, default,
                               locpath
                                 (step (child,
                                    namet (last)),
                                 varref ($a)),
                               orderspecs
                                 (asc, empty least, default,
                                 locpath
                                   (step (child,
                                      namet (first)),
                                   varref ($a)), nil ()))),
                           varref ($a))),
                      binds
                        (let (nil (), varref ($aut2),
                           flwr
                             (binds
                                (bind (nil (), nil (),
                                   varref ($a),
                                   locpath
                                     (step (child,
                                        namet (author)),
                                     varref ($book2))),
                                nil ()), nil (),
                             orderby (unstable,
                               orderspecs
                                 (asc, empty least, default,
                                 locpath
                                   (step (child,
                                      namet (last)),
                                   varref ($a)),
                                 orderspecs
                                   (asc, empty least,
                                      default,
                                   locpath
                                     (step (child,
                                        namet (first)),
                                     varref ($a)), nil ()))),
                             varref ($a))), nil ()))),
                 and
                   (and
                      (ltlt (varref ($book1),
                         varref ($book2)),
                      fun_ref (not,
                        args
                          (eq
                             (locpath
                                (step (child,
                                   namet (title)),
                                varref ($book1)),
                             locpath
                               (step (child, namet (title)),
                               varref ($book2))), nil ()))),
                   fun_ref (sequence-deep-equal,
                     args (varref ($aut1),
                       args (varref ($aut2), nil ())))),
                 nil (),
                 elem (tag (book-pair),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq
                          (locpath
                             (step (child, namet (title)),
                             varref ($book1)),
                          empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (exprseq
                              (locpath
                                 (step (child,
                                    namet (title)),
                                 varref ($book2)),
                              empty-seq ()),
                           exprseq (empty-seq (),
                             empty-seq ()))))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery
  (prolog (nil (),
     fun_decls
       (fun_decl (toc,
          params
            (param (seq_ty (1, node_ty (element, nil ())),
               varref ($e)), nil ()),
          seq_ty (*, node_ty (element, nil ())),
          exprseq
            (flwr
               (binds
                  (let (nil (), varref ($n),
                     fun_ref (local-name,
                       args (varref ($e), nil ()))),
                  nil ()), nil (), nil (),
               if (eq (varref ($n), lit_str ("section")),
                 elem (tag (section),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq
                          (locpath
                             (step (attribute, namet (*:*)),
                             varref ($e)), empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (exprseq
                              (fun_ref (toc,
                                 args
                                   (locpath
                                      (step (child,
                                         namet (*:*)),
                                      varref ($e)), nil ())),
                              empty-seq ()),
                           exprseq (empty-seq (),
                             empty-seq ())))))),
                 if (eq (varref ($n), lit_str ("title")),
                   varref ($e), empty-seq ()))),
            empty-seq ())), nil ())),
  exprseq
    (elem (tag (toc),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (fun_ref (toc,
                 args
                   (locpath (step (child, namet (book)),
                      fun_ref (document,
                        args (lit_str ("book.xml"), nil ()))),
                   nil ())), empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (figlist),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($f),
                       locpath
                         (step (child, namet (figure)),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (document,
                             args (lit_str ("book.xml"),
                               nil ()))))), nil ()), nil (),
                 nil (),
                 elem (tag (figure),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq
                          (locpath
                             (step (attribute, namet (*:*)),
                             varref ($f)), empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (exprseq
                              (locpath
                                 (step (child,
                                    namet (title)),
                                 varref ($f)),
                              empty-seq ()),
                           exprseq (empty-seq (),
                             empty-seq ()))))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (section_count),
       exprseq
         (exprseq
            (fun_ref (count,
               args
                 (locpath (step (child, namet (section)),
                    locpath
                      (step (descendant-or-self,
                         kindt (node, nil ())),
                      fun_ref (document,
                        args (lit_str ("book.xml"), nil ())))),
                 nil ())), empty-seq ()), empty-seq ())),
    exprseq
      (elem (tag (figure_count),
         exprseq
           (exprseq
              (fun_ref (count,
                 args
                   (locpath (step (child, namet (figure)),
                      locpath
                        (step (descendant-or-self,
                           kindt (node, nil ())),
                        fun_ref (document,
                          args (lit_str ("book.xml"),
                            nil ())))), nil ())),
              empty-seq ()), empty-seq ())), empty-seq ())))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (top_section_count),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (fun_ref (count,
                 args
                   (locpath (step (child, namet (section)),
                      locpath (step (child, namet (book)),
                        fun_ref (document,
                          args (lit_str ("book.xml"),
                            nil ())))), nil ())),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (section_list),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($s),
                       locpath
                         (step (child, namet (section)),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (document,
                             args (lit_str ("book.xml"),
                               nil ()))))),
                    binds
                      (let (nil (), varref ($f),
                         locpath
                           (step (child, namet (figure)),
                           varref ($s))), nil ())), nil (),
                 nil (),
                 elem (tag (section),
                   exprseq
                     (attr (tag (title),
                        exprseq
                          (exprseq
                             (locpath
                                (step (child,
                                   kindt (text, nil ())),
                                locpath
                                  (step (child,
                                     namet (title)),
                                  varref ($s))),
                             empty-seq ()), empty-seq ())),
                     exprseq
                       (attr (tag (figcount),
                          exprseq
                            (exprseq
                               (fun_ref (count,
                                  args (varref ($f), nil ())),
                               empty-seq ()), empty-seq ())),
                       empty-seq ())))), empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery
  (prolog (nil (),
     fun_decls
       (fun_decl (section_summary,
          params
            (param (seq_ty (1, node_ty (element, nil ())),
               varref ($s)), nil ()),
          seq_ty (1, node_ty (element, nil ())),
          exprseq
            (elem (tag (section),
               exprseq (empty-seq (),
                 exprseq
                   (exprseq
                      (locpath
                         (step (attribute, namet (*:*)),
                         varref ($s)), empty-seq ()),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq
                          (locpath
                             (step (child, namet (title)),
                             varref ($s)), empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (elem (tag (figcount),
                              exprseq
                                (exprseq
                                   (fun_ref (count,
                                      args
                                        (locpath
                                           (step (child,
                                              namet (figure)),
                                           varref ($s)),
                                        nil ())),
                                   empty-seq ()),
                                empty-seq ())),
                           exprseq (empty-seq (),
                             exprseq
                               (exprseq
                                  (flwr
                                     (binds
                                        (bind (nil (),
                                           nil (),
                                           varref ($ss),
                                           locpath
                                             (step (child,
                                                namet
                                                  (section)),
                                             varref ($s))),
                                        nil ()), nil (),
                                     nil (),
                                     fun_ref
                                       (section_summary,
                                       args (varref ($ss),
                                         nil ()))),
                                  empty-seq ()),
                               exprseq (empty-seq (),
                                 empty-seq ())))))))))),
            empty-seq ())), nil ())),
  exprseq
    (elem (tag (toc),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($s),
                       locpath
                         (step (child, namet (section)),
                         locpath
                           (step (child, namet (book)),
                           fun_ref (document,
                             args (lit_str ("book.xml"),
                               nil ()))))), nil ()), nil (),
                 nil (),
                 fun_ref (section_summary,
                   args (varref ($s), nil ()))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (flwr
       (binds
          (bind (nil (), nil (), varref ($s),
             locpath
               (pred
                  (locpath (step (child, namet (section)),
                     dot ()),
                  eq
                    (locpath
                       (step (child, namet (section.title)),
                       dot ()), lit_str ("Procedure"))),
               locpath
                 (step (descendant-or-self,
                    kindt (node, nil ())),
                 fun_ref (document,
                   args (lit_str ("report1.xml"), nil ()))))),
          nil ()), nil (), nil (),
       locpath (step (child, namet (instrument)),
         pred
           (exprseq
              (locpath (step (child, namet (incision)),
                 locpath
                   (step (descendant-or-self,
                      kindt (node, nil ())), varref ($s))),
              empty-seq ()), lit_int (2)))), empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (flwr
       (binds
          (bind (nil (), nil (), varref ($s),
             locpath
               (pred
                  (locpath (step (child, namet (section)),
                     dot ()),
                  eq
                    (locpath
                       (step (child, namet (section.title)),
                       dot ()), lit_str ("Procedure"))),
               locpath
                 (step (descendant-or-self,
                    kindt (node, nil ())),
                 fun_ref (document,
                   args (lit_str ("report1.xml"), nil ()))))),
          nil ()), nil (), nil (),
       pred
         (exprseq
            (locpath (step (child, namet (instrument)),
               locpath
                 (step (descendant-or-self,
                    kindt (node, nil ())), varref ($s))),
            empty-seq ()),
         le (fun_ref (position, nil ()), lit_int (2)))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (flwr
       (binds
          (let (nil (), varref ($i2),
             pred
               (exprseq
                  (locpath (step (child, namet (incision)),
                     locpath
                       (step (descendant-or-self,
                          kindt (node, nil ())),
                       fun_ref (document,
                         args (lit_str ("report1.xml"),
                           nil ())))), empty-seq ()),
               lit_int (2))),
          binds
            (bind (nil (), nil (), varref ($a),
               pred
                 (pred
                    (exprseq
                       (locpath
                          (step (child, namet (action)),
                          locpath
                            (step (descendant-or-self,
                               kindt (node, nil ())),
                            fun_ref (document,
                              args (lit_str ("report1.xml"),
                                nil ())))), empty-seq ()),
                    gtgt
                      (locpath
                         (step (self, kindt (node, nil ())),
                         dot ()), varref ($i2))),
                 le (fun_ref (position, nil ()),
                   lit_int (2)))), nil ())), nil (), nil (),
       locpath (step (child, namet (instrument)),
         locpath
           (step (descendant-or-self, kindt (node, nil ())),
           varref ($a)))), empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (flwr
       (binds
          (bind (nil (), nil (), varref ($p),
             locpath
               (pred
                  (locpath (step (child, namet (section)),
                     dot ()),
                  eq
                    (locpath
                       (step (child, namet (section.title)),
                       dot ()), lit_str ("Procedure"))),
               locpath
                 (step (descendant-or-self,
                    kindt (node, nil ())),
                 fun_ref (document,
                   args (lit_str ("report1.xml"), nil ()))))),
          nil ()),
       fun_ref (not,
         args
           (some
              (binds
                 (bind (nil (), nil (), varref ($a),
                    locpath
                      (step (child, namet (anesthesia)),
                      locpath
                        (step (descendant-or-self,
                           kindt (node, nil ())),
                        varref ($p)))), nil ()),
              ltlt (varref ($a),
                pred
                  (exprseq
                     (locpath
                        (step (child, namet (incision)),
                        locpath
                          (step (descendant-or-self,
                             kindt (node, nil ())),
                          varref ($p))), empty-seq ()),
                  lit_int (1)))), nil ())), nil (),
       varref ($p)), empty-seq ()))
--
xquery
  (prolog (nil (),
     fun_decls
       (fun_decl (precedes,
          params
            (param (seq_ty (1, node_ty (node, nil ())),
               varref ($a)),
            params
              (param (seq_ty (1, node_ty (node, nil ())),
                 varref ($b)), nil ())),
          seq_ty (1, atom_ty (boolean, nil ())),
          exprseq
            (and (ltlt (varref ($a), varref ($b)),
               fun_ref (empty,
                 args
                   (intersect
                      (locpath
                         (step (child,
                            kindt (node, nil ())),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           varref ($a))), varref ($b)),
                   nil ()))), empty-seq ())),
       fun_decls
         (fun_decl (follows,
            params
              (param (seq_ty (1, node_ty (node, nil ())),
                 varref ($a)),
              params
                (param (seq_ty (1, node_ty (node, nil ())),
                   varref ($b)), nil ())),
            seq_ty (1, atom_ty (boolean, nil ())),
            exprseq
              (and (gtgt (varref ($a), varref ($b)),
                 fun_ref (empty,
                   args
                     (intersect
                        (locpath
                           (step (child,
                              kindt (node, nil ())),
                           locpath
                             (step (descendant-or-self,
                                kindt (node, nil ())),
                             varref ($b))), varref ($a)),
                     nil ()))), empty-seq ())), nil ()))),
  exprseq
    (elem (tag (critical_sequence),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (let (nil (), varref ($proc),
                       locpath
                         (pred
                            (pred
                               (locpath
                                  (step (child,
                                     namet (section)),
                                  dot ()),
                               eq
                                 (locpath
                                    (step (child,
                                       namet (section.title)),
                                    dot ()),
                                 lit_str ("Procedure"))),
                            lit_int (1)),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (document,
                             args (lit_str ("report1.xml"),
                               nil ()))))),
                    binds
                      (bind (nil (), nil (), varref ($n),
                         locpath
                           (step (child,
                              kindt (node, nil ())),
                           locpath
                             (step (descendant-or-self,
                                kindt (node, nil ())),
                             varref ($proc)))), nil ())),
                 and
                   (fun_ref (follows,
                      args (varref ($n),
                        args
                          (pred
                             (exprseq
                                (locpath
                                   (step (child,
                                      namet (incision)),
                                   locpath
                                     (step
                                        (descendant-or-self,
                                        kindt (node, nil ())),
                                     varref ($proc))),
                                empty-seq ()), lit_int (1)),
                          nil ()))),
                   fun_ref (precedes,
                     args (varref ($n),
                       args
                         (pred
                            (exprseq
                               (locpath
                                  (step (child,
                                     namet (incision)),
                                  locpath
                                    (step
                                       (descendant-or-self,
                                       kindt (node, nil ())),
                                    varref ($proc))),
                               empty-seq ()), lit_int (2)),
                         nil ())))), nil (), varref ($n)),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (critical_sequence),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (let (nil (), varref ($proc),
                       locpath
                         (pred
                            (pred
                               (locpath
                                  (step (child,
                                     namet (section)),
                                  dot ()),
                               eq
                                 (locpath
                                    (step (child,
                                       namet (section.title)),
                                    dot ()),
                                 lit_str ("Procedure"))),
                            lit_int (1)),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (document,
                             args (lit_str ("report1.xml"),
                               nil ()))))),
                    binds
                      (bind (nil (), nil (), varref ($n),
                         except
                           (locpath
                              (step (child,
                                 kindt (node, nil ())),
                              locpath
                                (step (descendant-or-self,
                                   kindt (node, nil ())),
                                varref ($proc))),
                           locpath
                             (step (child,
                                kindt (node, nil ())),
                             locpath
                               (step (descendant-or-self,
                                  kindt (node, nil ())),
                               varref ($i1))))), nil ())),
                 and (gtgt (varref ($n), varref ($i1)),
                   ltlt (varref ($n), varref ($i2))),
                 nil (), varref ($n)), empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($i),
                       locpath
                         (step (child, namet (item_tuple)),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (document,
                             args (lit_str ("items.xml"),
                               nil ()))))), nil ()),
                 and
                   (and
                      (le
                         (locpath
                            (step (child,
                               namet (start_date)),
                            varref ($i)),
                         fun_ref (current-date, nil ())),
                      ge
                        (locpath
                           (step (child, namet (end_date)),
                           varref ($i)),
                        fun_ref (current-date, nil ()))),
                   fun_ref (contains,
                     args
                       (locpath
                          (step (child,
                             namet (description)),
                          varref ($i)),
                       args (lit_str ("Bicycle"), nil ())))),
                 orderby (unstable,
                   orderspecs (asc, empty least, default,
                     locpath (step (child, namet (itemno)),
                       varref ($i)), nil ())),
                 elem (tag (item_tuple),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq
                          (locpath
                             (step (child, namet (itemno)),
                             varref ($i)), empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (exprseq
                              (locpath
                                 (step (child,
                                    namet (description)),
                                 varref ($i)),
                              empty-seq ()),
                           exprseq (empty-seq (),
                             empty-seq ()))))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($i),
                       locpath
                         (step (child, namet (item_tuple)),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (document,
                             args (lit_str ("items.xml"),
                               nil ()))))),
                    binds
                      (let (nil (), varref ($b),
                         locpath
                           (pred
                              (locpath
                                 (step (child,
                                    namet (bid_tuple)),
                                 dot ()),
                              eq
                                (locpath
                                   (step (child,
                                      namet (itemno)),
                                   dot ()),
                                locpath
                                  (step (child,
                                     namet (itemno)),
                                  varref ($i)))),
                           locpath
                             (step (descendant-or-self,
                                kindt (node, nil ())),
                             fun_ref (document,
                               args (lit_str ("bids.xml"),
                                 nil ()))))), nil ())),
                 fun_ref (contains,
                   args
                     (locpath
                        (step (child, namet (description)),
                        varref ($i)),
                     args (lit_str ("Bicycle"), nil ()))),
                 orderby (unstable,
                   orderspecs (asc, empty least, default,
                     locpath (step (child, namet (itemno)),
                       varref ($i)), nil ())),
                 elem (tag (item_tuple),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq
                          (locpath
                             (step (child, namet (itemno)),
                             varref ($i)), empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (exprseq
                              (locpath
                                 (step (child,
                                    namet (description)),
                                 varref ($i)),
                              empty-seq ()),
                           exprseq (empty-seq (),
                             exprseq
                               (elem (tag (high_bid),
                                  exprseq
                                    (exprseq
                                       (fun_ref (max,
                                          args
                                            (flwr
                                               (binds
                                                  (bind
                                                     (nil
                                                        (),
                                                     nil (),
                                                     varref
                                                       ($z),
                                                     locpath
                                                       (step
                                                          (child,
                                                          namet
                                                            (bid)),
                                                       varref
                                                         ($b))),
                                                  nil ()),
                                               nil (),
                                               nil (),
                                               fun_ref
                                                 (decimal,
                                                 args
                                                   (varref
                                                      ($z),
                                                   nil ()))),
                                            nil ())),
                                       empty-seq ()),
                                    empty-seq ())),
                               exprseq (empty-seq (),
                                 empty-seq ()))))))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($u),
                       locpath
                         (step (child, namet (user_tuple)),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (document,
                             args (lit_str ("users.xml"),
                               nil ()))))),
                    binds
                      (bind (nil (), nil (), varref ($i),
                         locpath
                           (step (child,
                              namet (item_tuple)),
                           locpath
                             (step (descendant-or-self,
                                kindt (node, nil ())),
                             fun_ref (document,
                               args (lit_str ("items.xml"),
                                 nil ()))))), nil ())),
                 and
                   (and
                      (gt
                         (locpath
                            (step (child, namet (rating)),
                            varref ($u)), lit_str ("C")),
                      gt
                        (locpath
                           (step (child,
                              namet (reserve_price)),
                           varref ($i)), lit_int (1000))),
                   eq
                     (locpath
                        (step (child, namet (offered_by)),
                        varref ($i)),
                     locpath (step (child, namet (userid)),
                       varref ($u)))), nil (),
                 elem (tag (warning),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq
                          (locpath
                             (step (child, namet (name)),
                             varref ($u)), empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (exprseq
                              (locpath
                                 (step (child,
                                    namet (rating)),
                                 varref ($u)),
                              empty-seq ()),
                           exprseq (empty-seq (),
                             exprseq
                               (exprseq
                                  (locpath
                                     (step (child,
                                        namet (description)),
                                     varref ($i)),
                                  empty-seq ()),
                               exprseq (empty-seq (),
                                 exprseq
                                   (exprseq
                                      (locpath
                                         (step (child,
                                            namet
                                              (reserve_price)),
                                         varref ($i)),
                                      empty-seq ()),
                                   exprseq (empty-seq (),
                                     empty-seq ()))))))))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($i),
                       locpath
                         (step (child, namet (item_tuple)),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (document,
                             args (lit_str ("items.xml"),
                               nil ()))))), nil ()),
                 fun_ref (empty,
                   args
                     (locpath
                        (pred
                           (locpath
                              (step (child,
                                 namet (bid_tuple)),
                              dot ()),
                           eq
                             (locpath
                                (step (child,
                                   namet (itemno)), dot ()),
                             locpath
                               (step (child,
                                  namet (itemno)),
                               varref ($i)))),
                        locpath
                          (step (descendant-or-self,
                             kindt (node, nil ())),
                          fun_ref (document,
                            args (lit_str ("bids.xml"),
                              nil ())))), nil ())), nil (),
                 elem (tag (no_bid_item),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq
                          (locpath
                             (step (child, namet (itemno)),
                             varref ($i)), empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (exprseq
                              (locpath
                                 (step (child,
                                    namet (description)),
                                 varref ($i)),
                              empty-seq ()),
                           exprseq (empty-seq (),
                             empty-seq ()))))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($seller),
                       locpath
                         (step (child, namet (user_tuple)),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (document,
                             args (lit_str ("users.xml"),
                               nil ()))))),
                    binds
                      (bind (nil (), nil (),
                         varref ($buyer),
                         locpath
                           (step (child,
                              namet (user_tuple)),
                           locpath
                             (step (descendant-or-self,
                                kindt (node, nil ())),
                             fun_ref (document,
                               args (lit_str ("users.xml"),
                                 nil ()))))),
                      binds
                        (bind (nil (), nil (),
                           varref ($item),
                           locpath
                             (step (child,
                                namet (item_tuple)),
                             locpath
                               (step (descendant-or-self,
                                  kindt (node, nil ())),
                               fun_ref (document,
                                 args
                                   (lit_str ("items.xml"),
                                   nil ()))))),
                        binds
                          (bind (nil (), nil (),
                             varref ($highbid),
                             locpath
                               (step (child,
                                  namet (bid_tuple)),
                               locpath
                                 (step (descendant-or-self,
                                    kindt (node, nil ())),
                                 fun_ref (document,
                                   args
                                     (lit_str ("bids.xml"),
                                     nil ()))))), nil ())))),
                 and
                   (and
                      (and
                         (and
                            (and
                               (eq
                                  (locpath
                                     (step (child,
                                        namet (name)),
                                     varref ($seller)),
                                  lit_str ("Tom Jones")),
                               eq
                                 (locpath
                                    (step (child,
                                       namet (userid)),
                                    varref ($seller)),
                                 locpath
                                   (step (child,
                                      namet (offered_by)),
                                   varref ($item)))),
                            fun_ref (contains,
                              args
                                (locpath
                                   (step (child,
                                      namet (description)),
                                   varref ($item)),
                                args (lit_str ("Bicycle"),
                                  nil ())))),
                         eq
                           (locpath
                              (step (child, namet (itemno)),
                              varref ($item)),
                           locpath
                             (step (child, namet (itemno)),
                             varref ($highbid)))),
                      eq
                        (locpath
                           (step (child, namet (userid)),
                           varref ($highbid)),
                        locpath
                          (step (child, namet (userid)),
                          varref ($buyer)))),
                   eq
                     (locpath (step (child, namet (bid)),
                        varref ($highbid)),
                     fun_ref (max,
                       args
                         (flwr
                            (binds
                               (bind (nil (), nil (),
                                  varref ($x),
                                  locpath
                                    (step (child,
                                       namet (bid)),
                                    locpath
                                      (pred
                                         (locpath
                                            (step (child,
                                               namet
                                                 (bid_tuple)),
                                            dot ()),
                                         eq
                                           (locpath
                                              (step (child,
                                                 namet
                                                   (itemno)),
                                              dot ()),
                                           locpath
                                             (step (child,
                                                namet
                                                  (itemno)),
                                             varref ($item)))),
                                      locpath
                                        (step
                                           (descendant-or-self,
                                           kindt (node,
                                             nil ())),
                                        fun_ref (document,
                                          args
                                            (lit_str
                                               ("bids.xml"),
                                            nil ())))))),
                               nil ()), nil (), nil (),
                            fun_ref (decimal,
                              args (varref ($x), nil ()))),
                         nil ())))),
                 orderby (unstable,
                   orderspecs (asc, empty least, default,
                     exprseq
                       (locpath
                          (step (child, namet (itemno)),
                          varref ($item)), empty-seq ()),
                     nil ())),
                 elem (tag (jones_bike),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq
                          (locpath
                             (step (child, namet (itemno)),
                             varref ($item)), empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (exprseq
                              (locpath
                                 (step (child,
                                    namet (description)),
                                 varref ($item)),
                              empty-seq ()),
                           exprseq (empty-seq (),
                             exprseq
                               (elem (tag (high_bid),
                                  exprseq
                                    (exprseq
                                       (locpath
                                          (step (child,
                                             namet (bid)),
                                          varref ($highbid)),
                                       empty-seq ()),
                                    empty-seq ())),
                               exprseq (empty-seq (),
                                 exprseq
                                   (elem (tag (high_bidder),
                                      exprseq
                                        (exprseq
                                           (locpath
                                              (step (child,
                                                 namet
                                                   (name)),
                                              varref
                                                ($buyer)),
                                           empty-seq ()),
                                        empty-seq ())),
                                   exprseq (empty-seq (),
                                     empty-seq ()))))))))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($seller),
                       fun_ref (unordered,
                         args
                           (locpath
                              (step (child,
                                 namet (user_tuple)),
                              locpath
                                (step (descendant-or-self,
                                   kindt (node, nil ())),
                                fun_ref (document,
                                  args
                                    (lit_str ("users.xml"),
                                    nil ())))), nil ()))),
                    binds
                      (bind (nil (), nil (),
                         varref ($buyer),
                         fun_ref (unordered,
                           args
                             (locpath
                                (step (child,
                                   namet (user_tuple)),
                                locpath
                                  (step (descendant-or-self,
                                     kindt (node, nil ())),
                                  fun_ref (document,
                                    args
                                      (lit_str
                                         ("users.xml"),
                                      nil ())))), nil ()))),
                      binds
                        (bind (nil (), nil (),
                           varref ($item),
                           fun_ref (unordered,
                             args
                               (locpath
                                  (step (child,
                                     namet (item_tuple)),
                                  locpath
                                    (step
                                       (descendant-or-self,
                                       kindt (node, nil ())),
                                    fun_ref (document,
                                      args
                                        (lit_str
                                           ("items.xml"),
                                        nil ())))), nil ()))),
                        binds
                          (bind (nil (), nil (),
                             varref ($highbid),
                             locpath
                               (step (child,
                                  namet (bid_tuple)),
                               locpath
                                 (step (descendant-or-self,
                                    kindt (node, nil ())),
                                 fun_ref (document,
                                   args
                                     (lit_str ("bids.xml"),
                                     nil ()))))), nil ())))),
                 and
                   (and
                      (and
                         (and
                            (and
                               (eq
                                  (locpath
                                     (step (child,
                                        namet (name)),
                                     varref ($seller)),
                                  lit_str ("Tom Jones")),
                               eq
                                 (locpath
                                    (step (child,
                                       namet (userid)),
                                    varref ($seller)),
                                 locpath
                                   (step (child,
                                      namet (offered_by)),
                                   varref ($item)))),
                            fun_ref (contains,
                              args
                                (locpath
                                   (step (child,
                                      namet (description)),
                                   varref ($item)),
                                args (lit_str ("Bicycle"),
                                  nil ())))),
                         eq
                           (locpath
                              (step (child, namet (itemno)),
                              varref ($item)),
                           locpath
                             (step (child, namet (itemno)),
                             varref ($highbid)))),
                      eq
                        (locpath
                           (step (child, namet (userid)),
                           varref ($highbid)),
                        locpath
                          (step (child, namet (userid)),
                          varref ($buyer)))),
                   eq
                     (locpath (step (child, namet (bid)),
                        varref ($highbid)),
                     fun_ref (max,
                       args
                         (flwr
                            (binds
                               (bind (nil (), nil (),
                                  varref ($x),
                                  locpath
                                    (step (child,
                                       namet (bid)),
                                    pred
                                      (fun_ref (unordered,
                                         args
                                           (locpath
                                              (step (child,
                                                 namet
                                                   (bid_tuple)),
                                              locpath
                                                (step
                                                   (descendant-or-self,
                                                   kindt
                                                     (node,
                                                     nil ())),
                                                fun_ref
                                                  (document,
                                                  args
                                                    (lit_str
                                                       ("bids.xml"),
                                                    nil ())))),
                                           nil ())),
                                      eq
                                        (locpath
                                           (step (child,
                                              namet (itemno)),
                                           dot ()),
                                        locpath
                                          (step (child,
                                             namet (itemno)),
                                          varref ($item)))))),
                               nil ()), nil (), nil (),
                            fun_ref (decimal,
                              args
                                (fun_ref (data,
                                   args (varref ($x),
                                     nil ())), nil ()))),
                         nil ())))),
                 orderby (unstable,
                   orderspecs (asc, empty least, default,
                     locpath (step (child, namet (itemno)),
                       varref ($item)), nil ())),
                 elem (tag (jones_bike),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq
                          (locpath
                             (step (child, namet (itemno)),
                             varref ($item)), empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (exprseq
                              (locpath
                                 (step (child,
                                    namet (description)),
                                 varref ($item)),
                              empty-seq ()),
                           exprseq (empty-seq (),
                             exprseq
                               (elem (tag (high_bid),
                                  exprseq
                                    (exprseq
                                       (locpath
                                          (step (child,
                                             namet (bid)),
                                          varref ($highbid)),
                                       empty-seq ()),
                                    empty-seq ())),
                               exprseq (empty-seq (),
                                 exprseq
                                   (elem (tag (high_bidder),
                                      exprseq
                                        (exprseq
                                           (locpath
                                              (step (child,
                                                 namet
                                                   (name)),
                                              varref
                                                ($buyer)),
                                           empty-seq ()),
                                        empty-seq ())),
                                   exprseq (empty-seq (),
                                     empty-seq ()))))))))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($item),
                       locpath
                         (step (child, namet (item_tuple)),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (document,
                             args (lit_str ("items.xml"),
                               nil ()))))),
                    binds
                      (let (nil (), varref ($b),
                         locpath
                           (pred
                              (locpath
                                 (step (child,
                                    namet (bid_tuple)),
                                 dot ()),
                              eq
                                (locpath
                                   (step (child,
                                      namet (itemno)),
                                   dot ()),
                                locpath
                                  (step (child,
                                     namet (itemno)),
                                  varref ($item)))),
                           locpath
                             (step (descendant-or-self,
                                kindt (node, nil ())),
                             fun_ref (document,
                               args (lit_str ("bids.xml"),
                                 nil ()))))),
                      binds
                        (let (nil (), varref ($z),
                           fun_ref (max,
                             args
                               (flwr
                                  (binds
                                     (bind (nil (), nil (),
                                        varref ($x),
                                        locpath
                                          (step (child,
                                             namet (bid)),
                                          varref ($b))),
                                     nil ()), nil (),
                                  nil (),
                                  fun_ref (decimal,
                                    args (varref ($x),
                                      nil ()))), nil ()))),
                        nil ()))),
                 lt
                   (mult
                      (locpath
                         (step (child,
                            namet (reserve_price)),
                         varref ($item)), lit_int (2)),
                   varref ($z)), nil (),
                 elem (tag (successful_item),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq
                          (locpath
                             (step (child, namet (itemno)),
                             varref ($item)), empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (exprseq
                              (locpath
                                 (step (child,
                                    namet (description)),
                                 varref ($item)),
                              empty-seq ()),
                           exprseq (empty-seq (),
                             exprseq
                               (exprseq
                                  (locpath
                                     (step (child,
                                        namet
                                          (reserve_price)),
                                     varref ($item)),
                                  empty-seq ()),
                               exprseq (empty-seq (),
                                 exprseq
                                   (elem (tag (high_bid),
                                      exprseq
                                        (exprseq
                                           (varref ($z),
                                           empty-seq ()),
                                        empty-seq ())),
                                   exprseq (empty-seq (),
                                     empty-seq ()))))))))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (flwr
       (binds
          (let (nil (), varref ($allbikes),
             locpath
               (pred
                  (locpath
                     (step (child, namet (item_tuple)),
                     dot ()),
                  or
                    (fun_ref (contains,
                       args
                         (locpath
                            (step (child,
                               namet (description)),
                            dot ()),
                         args (lit_str ("Bicycle"), nil ()))),
                    fun_ref (contains,
                      args
                        (locpath
                           (step (child,
                              namet (description)), dot ()),
                        args (lit_str ("Tricycle"), nil ()))))),
               locpath
                 (step (descendant-or-self,
                    kindt (node, nil ())),
                 fun_ref (document,
                   args (lit_str ("items.xml"), nil ()))))),
          binds
            (let (nil (), varref ($bikebids),
               locpath
                 (pred
                    (locpath
                       (step (child, namet (bid_tuple)),
                       dot ()),
                    eq
                      (locpath
                         (step (child, namet (itemno)),
                         dot ()),
                      locpath (step (child, namet (itemno)),
                        varref ($allbikes)))),
                 locpath
                   (step (descendant-or-self,
                      kindt (node, nil ())),
                   fun_ref (document,
                     args (lit_str ("bids.xml"), nil ()))))),
            nil ())), nil (), nil (),
       elem (tag (high_bid),
         exprseq (empty-seq (),
           exprseq
             (exprseq
                (fun_ref (max,
                   args
                     (flwr
                        (binds
                           (bind (nil (), nil (),
                              varref ($x),
                              locpath
                                (step (child, namet (bid)),
                                varref ($bikebids))),
                           nil ()), nil (), nil (),
                        fun_ref (decimal,
                          args (varref ($x), nil ()))),
                     nil ())), empty-seq ()),
             exprseq (empty-seq (), empty-seq ()))))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (flwr
       (binds
          (let (nil (), varref ($item),
             locpath
               (pred
                  (locpath
                     (step (child, namet (item_tuple)),
                     dot ()),
                  and
                    (ge
                       (locpath
                          (step (child, namet (end_date)),
                          dot ()),
                       fun_ref (date,
                         args (lit_str ("1999-03-01"),
                           nil ()))),
                    le
                      (locpath
                         (step (child, namet (end_date)),
                         dot ()),
                      fun_ref (date,
                        args (lit_str ("1999-03-31"),
                          nil ()))))),
               locpath
                 (step (descendant-or-self,
                    kindt (node, nil ())),
                 fun_ref (document,
                   args (lit_str ("items.xml"), nil ()))))),
          nil ()), nil (), nil (),
       elem (tag (item_count),
         exprseq (empty-seq (),
           exprseq
             (exprseq
                (fun_ref (count,
                   args (varref ($item), nil ())),
                empty-seq ()),
             exprseq (empty-seq (), empty-seq ()))))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (let (nil (), varref ($end_dates),
                       locpath
                         (step (child, namet (end_date)),
                         locpath
                           (step (child,
                              namet (item_tuple)),
                           locpath
                             (step (descendant-or-self,
                                kindt (node, nil ())),
                             fun_ref (document,
                               args (lit_str ("items.xml"),
                                 nil ())))))),
                    binds
                      (bind (nil (), nil (), varref ($m),
                         fun_ref (distinct-values,
                           args
                             (flwr
                                (binds
                                   (bind (nil (), nil (),
                                      varref ($e),
                                      varref ($end_dates)),
                                   nil ()), nil (), nil (),
                                fun_ref
                                  (get-month-from-date,
                                  args (varref ($e), nil ()))),
                             nil ()))),
                      binds
                        (let (nil (), varref ($item),
                           locpath
                             (pred
                                (locpath
                                   (step (child,
                                      namet (item_tuple)),
                                   dot ()),
                                and
                                  (eq
                                     (fun_ref
                                        (get-year-from-date,
                                        args
                                          (locpath
                                             (step (child,
                                                namet
                                                  (end_date)),
                                             dot ()),
                                          nil ())),
                                     lit_int (1999)),
                                  eq
                                    (fun_ref
                                       (get-month-from-date,
                                       args
                                         (locpath
                                            (step (child,
                                               namet
                                                 (end_date)),
                                            dot ()), nil ())),
                                    varref ($m)))),
                             locpath
                               (step (descendant-or-self,
                                  kindt (node, nil ())),
                               fun_ref (document,
                                 args
                                   (lit_str ("items.xml"),
                                   nil ()))))), nil ()))),
                 nil (),
                 orderby (unstable,
                   orderspecs (asc, empty least, default,
                     varref ($m), nil ())),
                 elem (tag (monthly_result),
                   exprseq (empty-seq (),
                     exprseq
                       (elem (tag (month),
                          exprseq
                            (exprseq (varref ($m),
                               empty-seq ()), empty-seq ())),
                       exprseq (empty-seq (),
                         exprseq
                           (elem (tag (item_count),
                              exprseq
                                (exprseq
                                   (fun_ref (count,
                                      args (varref ($item),
                                        nil ())),
                                   empty-seq ()),
                                empty-seq ())),
                           exprseq (empty-seq (),
                             empty-seq ()))))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (),
                       varref ($highbid),
                       locpath
                         (step (child, namet (bid_tuple)),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (document,
                             args (lit_str ("bids.xml"),
                               nil ()))))),
                    binds
                      (bind (nil (), nil (), varref ($user),
                         locpath
                           (step (child,
                              namet (user_tuple)),
                           locpath
                             (step (descendant-or-self,
                                kindt (node, nil ())),
                             fun_ref (document,
                               args (lit_str ("users.xml"),
                                 nil ()))))), nil ())),
                 and
                   (eq
                      (locpath
                         (step (child, namet (userid)),
                         varref ($user)),
                      locpath (step (child, namet (userid)),
                        varref ($highbid))),
                   eq
                     (locpath (step (child, namet (bid)),
                        varref ($highbid)),
                     fun_ref (max,
                       args
                         (flwr
                            (binds
                               (bind (nil (), nil (),
                                  varref ($x),
                                  locpath
                                    (step (child,
                                       namet (bid)),
                                    locpath
                                      (pred
                                         (locpath
                                            (step (child,
                                               namet
                                                 (bid_tuple)),
                                            dot ()),
                                         eq
                                           (locpath
                                              (step (child,
                                                 namet
                                                   (itemno)),
                                              dot ()),
                                           locpath
                                             (step (child,
                                                namet
                                                  (itemno)),
                                             varref
                                               ($highbid)))),
                                      locpath
                                        (step
                                           (descendant-or-self,
                                           kindt (node,
                                             nil ())),
                                        fun_ref (document,
                                          args
                                            (lit_str
                                               ("bids.xml"),
                                            nil ())))))),
                               nil ()), nil (), nil (),
                            fun_ref (decimal,
                              args (varref ($x), nil ()))),
                         nil ())))),
                 orderby (unstable,
                   orderspecs (asc, empty least, default,
                     locpath (step (child, namet (itemno)),
                       varref ($highbid)), nil ())),
                 elem (tag (high_bid),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq
                          (locpath
                             (step (child, namet (itemno)),
                             varref ($highbid)),
                          empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (exprseq
                              (locpath
                                 (step (child, namet (bid)),
                                 varref ($highbid)),
                              empty-seq ()),
                           exprseq (empty-seq (),
                             exprseq
                               (elem (tag (bidder),
                                  exprseq
                                    (exprseq
                                       (locpath
                                          (step (child,
                                             kindt (text,
                                               nil ())),
                                          locpath
                                            (step (child,
                                               namet (name)),
                                            varref ($user))),
                                       empty-seq ()),
                                    empty-seq ())),
                               exprseq (empty-seq (),
                                 empty-seq ()))))))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (flwr
       (binds
          (let (nil (), varref ($highbid),
             fun_ref (max,
               args
                 (flwr
                    (binds
                       (bind (nil (), nil (), varref ($x),
                          locpath
                            (step (child, namet (bid)),
                            locpath
                              (step (child,
                                 namet (bid_tuple)),
                              locpath
                                (step (descendant-or-self,
                                   kindt (node, nil ())),
                                fun_ref (document,
                                  args
                                    (lit_str ("bids.xml"),
                                    nil ())))))), nil ()),
                    nil (), nil (),
                    fun_ref (decimal,
                      args (varref ($x), nil ()))), nil ()))),
          nil ()), nil (), nil (),
       elem (tag (result),
         exprseq (empty-seq (),
           exprseq
             (exprseq
                (flwr
                   (binds
                      (bind (nil (), nil (), varref ($item),
                         locpath
                           (step (child,
                              namet (item_tuple)),
                           locpath
                             (step (descendant-or-self,
                                kindt (node, nil ())),
                             fun_ref (document,
                               args (lit_str ("items.xml"),
                                 nil ()))))),
                      binds
                        (bind (nil (), nil (), varref ($b),
                           locpath
                             (pred
                                (locpath
                                   (step (child,
                                      namet (bid_tuple)),
                                   dot ()),
                                eq
                                  (locpath
                                     (step (child,
                                        namet (itemno)),
                                     dot ()),
                                  locpath
                                    (step (child,
                                       namet (itemno)),
                                    varref ($item)))),
                             locpath
                               (step (descendant-or-self,
                                  kindt (node, nil ())),
                               fun_ref (document,
                                 args (lit_str ("bids.xml"),
                                   nil ()))))), nil ())),
                   eq
                     (locpath (step (child, namet (bid)),
                        varref ($b)), varref ($highbid)),
                   nil (),
                   elem (tag (expensive_item),
                     exprseq (empty-seq (),
                       exprseq
                         (exprseq
                            (locpath
                               (step (child,
                                  namet (itemno)),
                               varref ($item)),
                            empty-seq ()),
                         exprseq (empty-seq (),
                           exprseq
                             (exprseq
                                (locpath
                                   (step (child,
                                      namet (description)),
                                   varref ($item)),
                                empty-seq ()),
                             exprseq (empty-seq (),
                               exprseq
                                 (elem (tag (high_bid),
                                    exprseq
                                      (exprseq
                                         (varref ($highbid),
                                         empty-seq ()),
                                      empty-seq ())),
                                 exprseq (empty-seq (),
                                   empty-seq ()))))))))),
                empty-seq ()),
             exprseq (empty-seq (), empty-seq ()))))),
    empty-seq ()))
--
xquery
  (prolog (nil (),
     fun_decls
       (fun_decl (bid_summary, nil (), nil (),
          exprseq
            (flwr
               (binds
                  (bind (nil (), nil (), varref ($i),
                     fun_ref (distinct-values,
                       args
                         (locpath
                            (step (child, namet (itemno)),
                            locpath
                              (step (descendant-or-self,
                                 kindt (node, nil ())),
                              fun_ref (document,
                                args (lit_str ("bids.xml"),
                                  nil ())))), nil ()))),
                  binds
                    (let (nil (), varref ($b),
                       locpath
                         (pred
                            (locpath
                               (step (child,
                                  namet (bid_tuple)),
                               dot ()),
                            eq
                              (locpath
                                 (step (child,
                                    namet (itemno)),
                                 dot ()), varref ($i))),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (document,
                             args (lit_str ("bids.xml"),
                               nil ()))))), nil ())),
               nil (), nil (),
               elem (tag (bid_count),
                 exprseq (empty-seq (),
                   exprseq
                     (exprseq (varref ($i), empty-seq ()),
                     exprseq (empty-seq (),
                       exprseq
                         (elem (tag (nbids),
                            exprseq
                              (exprseq
                                 (fun_ref (count,
                                    args (varref ($b),
                                      nil ())),
                                 empty-seq ()),
                              empty-seq ())),
                         exprseq (empty-seq (),
                           empty-seq ()))))))),
            empty-seq ())), nil ())),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (let (nil (), varref ($bid_counts),
                       fun_ref (bid_summary, nil ())),
                    binds
                      (bind (nil (), nil (), varref ($item),
                         locpath
                           (step (child,
                              namet (item_tuple)),
                           locpath
                             (step (descendant-or-self,
                                kindt (node, nil ())),
                             fun_ref (document,
                               args (lit_str ("items.xml"),
                                 nil ()))))),
                      binds
                        (bind (nil (), nil (), varref ($bc),
                           varref ($bid_counts)), nil ()))),
                 and
                   (eq
                      (locpath (step (child, namet (nbids)),
                         varref ($bc)), varref ($maxbids)),
                   eq
                     (locpath (step (child, namet (itemno)),
                        varref ($item)),
                     locpath (step (child, namet (itemno)),
                       varref ($bc)))), nil (),
                 elem (tag (popular_item),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq
                          (locpath
                             (step (child, namet (itemno)),
                             varref ($item)), empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (exprseq
                              (locpath
                                 (step (child,
                                    namet (description)),
                                 varref ($item)),
                              empty-seq ()),
                           exprseq (empty-seq (),
                             exprseq
                               (elem (tag (bid_count),
                                  exprseq
                                    (exprseq
                                       (locpath
                                          (step (child,
                                             kindt (text,
                                               nil ())),
                                          locpath
                                            (step (child,
                                               namet (nbids)),
                                            varref ($bc))),
                                       empty-seq ()),
                                    empty-seq ())),
                               exprseq (empty-seq (),
                                 empty-seq ()))))))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($uid),
                       fun_ref (distinct-values,
                         args
                           (locpath
                              (step (child, namet (userid)),
                              locpath
                                (step (descendant-or-self,
                                   kindt (node, nil ())),
                                fun_ref (document,
                                  args
                                    (lit_str ("bids.xml"),
                                    nil ())))), nil ()))),
                    binds
                      (let (nil (), varref ($b),
                         locpath
                           (pred
                              (locpath
                                 (step (child,
                                    namet (bid_tuple)),
                                 dot ()),
                              eq
                                (locpath
                                   (step (child,
                                      namet (userid)),
                                   dot ()), varref ($uid))),
                           locpath
                             (step (descendant-or-self,
                                kindt (node, nil ())),
                             fun_ref (document,
                               args (lit_str ("bids.xml"),
                                 nil ()))))), nil ())),
                 nil (),
                 orderby (unstable,
                   orderspecs (asc, empty least, default,
                     locpath (step (child, namet (userid)),
                       varref ($u)), nil ())),
                 elem (tag (bidder),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq
                          (locpath
                             (step (child, namet (userid)),
                             varref ($u)), empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (exprseq
                              (locpath
                                 (step (child,
                                    namet (name)),
                                 varref ($u)),
                              empty-seq ()),
                           exprseq (empty-seq (),
                             exprseq
                               (elem (tag (bidcount),
                                  exprseq
                                    (exprseq
                                       (fun_ref (count,
                                          args (varref ($b),
                                            nil ())),
                                       empty-seq ()),
                                    empty-seq ())),
                               exprseq (empty-seq (),
                                 exprseq
                                   (elem (tag (avgbid),
                                      exprseq
                                        (exprseq
                                           (fun_ref (avg,
                                              args
                                                (flwr
                                                   (binds
                                                      (bind
                                                         (nil
                                                            (),
                                                         nil
                                                           (),
                                                         varref
                                                           ($x),
                                                         locpath
                                                           (step
                                                              (child,
                                                              namet
                                                                (bid)),
                                                           varref
                                                             ($b))),
                                                      nil ()),
                                                   nil (),
                                                   nil (),
                                                   fun_ref
                                                     (decimal,
                                                     args
                                                       (varref
                                                          ($x),
                                                       nil
                                                         ()))),
                                                nil ())),
                                           empty-seq ()),
                                        empty-seq ())),
                                   exprseq (empty-seq (),
                                     empty-seq ()))))))))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($i),
                       fun_ref (distinct-values,
                         args
                           (locpath
                              (step (child, namet (itemno)),
                              locpath
                                (step (descendant-or-self,
                                   kindt (node, nil ())),
                                fun_ref (document,
                                  args
                                    (lit_str ("bids.xml"),
                                    nil ())))), nil ()))),
                    binds
                      (let (nil (), varref ($b),
                         locpath
                           (pred
                              (locpath
                                 (step (child,
                                    namet (bid_tuple)),
                                 dot ()),
                              eq
                                (locpath
                                   (step (child,
                                      namet (itemno)),
                                   dot ()), varref ($i))),
                           locpath
                             (step (descendant-or-self,
                                kindt (node, nil ())),
                             fun_ref (document,
                               args (lit_str ("bids.xml"),
                                 nil ()))))),
                      binds
                        (let (nil (), varref ($avgbid),
                           fun_ref (decimal,
                             args
                               (fun_ref (avg,
                                  args
                                    (flwr
                                       (binds
                                          (bind (nil (),
                                             nil (),
                                             varref ($x),
                                             locpath
                                               (step (child,
                                                  namet
                                                    (bid)),
                                               varref ($b))),
                                          nil ()), nil (),
                                       nil (),
                                       fun_ref (decimal,
                                         args (varref ($x),
                                           nil ()))),
                                    nil ())), nil ()))),
                        nil ()))),
                 ge
                   (fun_ref (count,
                      args (varref ($b), nil ())),
                   lit_int (3)),
                 orderby (unstable,
                   orderspecs (desc, empty least, default,
                     varref ($avgbid), nil ())),
                 elem (tag (popular_item),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq (varref ($i), empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (elem (tag (avgbid),
                              exprseq
                                (exprseq (varref ($avgbid),
                                   empty-seq ()),
                                empty-seq ())),
                           exprseq (empty-seq (),
                             empty-seq ()))))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($u),
                       locpath
                         (step (child, namet (user_tuple)),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (document,
                             args (lit_str ("users.xml"),
                               nil ()))))),
                    binds
                      (let (nil (), varref ($b),
                         locpath
                           (pred
                              (locpath
                                 (step (child,
                                    namet (bid_tuple)),
                                 dot ()),
                              and
                                (eq
                                   (locpath
                                      (step (child,
                                         namet (userid)),
                                      dot ()),
                                   locpath
                                     (step (child,
                                        namet (userid)),
                                     varref ($u))),
                                ge
                                  (locpath
                                     (step (child,
                                        namet (bid)),
                                     dot ()), lit_int (100)))),
                           locpath
                             (step (descendant-or-self,
                                kindt (node, nil ())),
                             fun_ref (document,
                               args (lit_str ("bids.xml"),
                                 nil ()))))), nil ())),
                 gt
                   (fun_ref (count,
                      args (varref ($b), nil ())),
                   lit_int (1)), nil (),
                 elem (tag (big_spender),
                   exprseq
                     (exprseq
                        (locpath
                           (step (child,
                              kindt (text, nil ())),
                           locpath
                             (step (child, namet (name)),
                             varref ($u))), empty-seq ()),
                     empty-seq ()))), empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($u),
                       locpath
                         (step (child, namet (user_tuple)),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (document,
                             args (lit_str ("users.xml"),
                               nil ()))))),
                    binds
                      (let (nil (), varref ($b),
                         locpath
                           (pred
                              (locpath
                                 (step (child,
                                    namet (bid_tuple)),
                                 dot ()),
                              eq
                                (locpath
                                   (step (child,
                                      namet (userid)),
                                   dot ()),
                                locpath
                                  (step (child,
                                     namet (userid)),
                                  varref ($u)))),
                           locpath
                             (step (descendant-or-self,
                                kindt (node, nil ())),
                             fun_ref (document,
                               args (lit_str ("bids.xml"),
                                 nil ()))))), nil ())),
                 nil (),
                 orderby (unstable,
                   orderspecs (asc, empty least, default,
                     locpath (step (child, namet (userid)),
                       varref ($u)), nil ())),
                 elem (tag (user),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq
                          (locpath
                             (step (child, namet (userid)),
                             varref ($u)), empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (exprseq
                              (locpath
                                 (step (child,
                                    namet (name)),
                                 varref ($u)),
                              empty-seq ()),
                           exprseq (empty-seq (),
                             exprseq
                               (exprseq
                                  (if
                                     (fun_ref (empty,
                                        args (varref ($b),
                                          nil ())),
                                     elem (tag (status),
                                       exprseq
                                         (text
                                            (exprseq
                                               (lit_str
                                                  ("inactive"),
                                               empty-seq ())),
                                         empty-seq ())),
                                     elem (tag (status),
                                       exprseq
                                         (text
                                            (exprseq
                                               (lit_str
                                                  ("active"),
                                               empty-seq ())),
                                         empty-seq ()))),
                                  empty-seq ()),
                               exprseq (empty-seq (),
                                 empty-seq ()))))))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (frequent_bidder),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($u),
                       locpath
                         (step (child, namet (user_tuple)),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (document,
                             args (lit_str ("users.xml"),
                               nil ()))))), nil ()),
                 every
                   (binds
                      (bind (nil (), nil (), varref ($item),
                         locpath
                           (step (child,
                              namet (item_tuple)),
                           locpath
                             (step (descendant-or-self,
                                kindt (node, nil ())),
                             fun_ref (document,
                               args (lit_str ("items.xml"),
                                 nil ()))))), nil ()),
                   some
                     (binds
                        (bind (nil (), nil (), varref ($b),
                           locpath
                             (step (child,
                                namet (bid_tuple)),
                             locpath
                               (step (descendant-or-self,
                                  kindt (node, nil ())),
                               fun_ref (document,
                                 args (lit_str ("bids.xml"),
                                   nil ()))))), nil ()),
                     exprseq
                       (and
                          (eq
                             (locpath
                                (step (child,
                                   namet (itemno)),
                                varref ($item)),
                             locpath
                               (step (child,
                                  namet (itemno)),
                               varref ($b))),
                          eq
                            (locpath
                               (step (child,
                                  namet (userid)),
                               varref ($u)),
                            locpath
                              (step (child, namet (userid)),
                              varref ($b)))), empty-seq ()))),
                 nil (),
                 locpath (step (child, namet (name)),
                   varref ($u))), empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($u),
                       locpath
                         (step (child, namet (user_tuple)),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (document,
                             args (lit_str ("users.xml"),
                               nil ()))))), nil ()), nil (),
                 orderby (unstable,
                   orderspecs (asc, empty least, default,
                     locpath (step (child, namet (name)),
                       varref ($u)), nil ())),
                 elem (tag (user),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq
                          (locpath
                             (step (child, namet (name)),
                             varref ($u)), empty-seq ()),
                       exprseq (empty-seq (),
                         exprseq
                           (exprseq
                              (flwr
                                 (binds
                                    (bind (nil (), nil (),
                                       varref ($b),
                                       fun_ref
                                         (distinct-values,
                                         args
                                           (locpath
                                              (step (child,
                                                 namet
                                                   (itemno)),
                                              locpath
                                                (pred
                                                   (locpath
                                                      (step
                                                         (child,
                                                         namet
                                                           (bid_tuple)),
                                                      dot ()),
                                                   eq
                                                     (locpath
                                                        (step
                                                           (child,
                                                           namet
                                                             (userid)),
                                                        dot
                                                          ()),
                                                     locpath
                                                       (step
                                                          (child,
                                                          namet
                                                            (userid)),
                                                       varref
                                                         ($u)))),
                                                locpath
                                                  (step
                                                     (descendant-or-self,
                                                     kindt
                                                       (node,
                                                       nil
                                                         ())),
                                                  fun_ref
                                                    (document,
                                                    args
                                                      (lit_str
                                                         ("bids.xml"),
                                                      nil ()))))),
                                           nil ()))),
                                    binds
                                      (bind (nil (), nil (),
                                         varref ($i),
                                         locpath
                                           (pred
                                              (locpath
                                                 (step
                                                    (child,
                                                    namet
                                                      (item_tuple)),
                                                 dot ()),
                                              eq
                                                (locpath
                                                   (step
                                                      (child,
                                                      namet
                                                        (itemno)),
                                                   dot ()),
                                                varref ($b))),
                                           locpath
                                             (step
                                                (descendant-or-self,
                                                kindt (node,
                                                  nil ())),
                                             fun_ref
                                               (document,
                                               args
                                                 (lit_str
                                                    ("items.xml"),
                                                 nil ()))))),
                                      binds
                                        (let (nil (),
                                           varref ($descr),
                                           locpath
                                             (step (child,
                                                kindt (text,
                                                  nil ())),
                                             locpath
                                               (step (child,
                                                  namet
                                                    (description)),
                                               varref ($i)))),
                                        nil ()))), nil (),
                                 orderby (unstable,
                                   orderspecs
                                     (asc, empty least,
                                        default,
                                     varref ($descr),
                                     nil ())),
                                 elem (tag (bid_on_item),
                                   exprseq
                                     (exprseq
                                        (varref ($descr),
                                        empty-seq ()),
                                     empty-seq ()))),
                              empty-seq ()),
                           exprseq (empty-seq (),
                             empty-seq ()))))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (locpath (step (child, namet (para)),
                 locpath
                   (step (descendant-or-self,
                      kindt (node, nil ())),
                   locpath (step (child, namet (report)),
                     locpath
                       (step (descendant-or-self,
                          kindt (node, nil ())),
                       fun_ref (input, nil ()))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (locpath (step (child, namet (para)),
                 locpath (step (child, namet (intro)),
                   locpath
                     (step (descendant-or-self,
                        kindt (node, nil ())),
                     fun_ref (input, nil ())))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($c),
                       locpath
                         (step (child, namet (chapter)),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (input, nil ())))),
                    nil ()),
                 fun_ref (empty,
                   args
                     (locpath (step (child, namet (intro)),
                        varref ($c)), nil ())), nil (),
                 locpath (step (child, namet (para)),
                   locpath (step (child, namet (intro)),
                     locpath (step (child, namet (section)),
                       varref ($c))))), empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (pred
                 (exprseq
                    (locpath (step (child, namet (para)),
                       locpath
                         (step (descendant-or-self,
                            kindt (node, nil ())),
                         pred
                           (exprseq
                              (locpath
                                 (step (child,
                                    namet (section)),
                                 locpath
                                   (step
                                      (descendant-or-self,
                                      kindt (node, nil ())),
                                   pred
                                     (exprseq
                                        (locpath
                                           (step (child,
                                              namet
                                                (chapter)),
                                           locpath
                                             (step
                                                (descendant-or-self,
                                                kindt (node,
                                                  nil ())),
                                             fun_ref (input,
                                               nil ()))),
                                        empty-seq ()),
                                     lit_int (2)))),
                              empty-seq ()), lit_int (3)))),
                    empty-seq ()), lit_int (2)),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (locpath
                 (pred
                    (locpath (step (child, namet (para)),
                       dot ()),
                    eq
                      (locpath
                         (step (attribute,
                            namet (security)), dot ()),
                      lit_str ("c"))),
                 locpath
                   (step (descendant-or-self,
                      kindt (node, nil ())),
                   fun_ref (input, nil ()))), empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($s),
                       locpath
                         (step (attribute,
                            namet (shorttitle)),
                         locpath
                           (step (child, namet (section)),
                           locpath
                             (step (descendant-or-self,
                                kindt (node, nil ())),
                             fun_ref (input, nil ()))))),
                    nil ()), nil (), nil (),
                 elem (tag (stitle),
                   exprseq
                     (exprseq (varref ($s), empty-seq ()),
                     empty-seq ()))), empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($i),
                       locpath
                         (pred
                            (locpath
                               (step (child, namet (para)),
                               dot ()), lit_int (1)),
                         locpath
                           (step (child, namet (intro)),
                           locpath
                             (step (descendant-or-self,
                                kindt (node, nil ())),
                             fun_ref (input, nil ()))))),
                    nil ()), nil (), nil (),
                 elem (tag (first_letter),
                   exprseq
                     (exprseq
                        (fun_ref (substring,
                           args
                             (fun_ref (string,
                                args (varref ($i), nil ())),
                             args (lit_int (1),
                               args (lit_int (1), nil ())))),
                        empty-seq ()), empty-seq ()))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (locpath
                 (pred
                    (locpath (step (child, namet (section)),
                       dot ()),
                    fun_ref (contains,
                      args
                        (fun_ref (string,
                           args
                             (locpath
                                (step (child,
                                   namet (title)),
                                locpath
                                  (step (descendant-or-self,
                                     kindt (node, nil ())),
                                  locpath
                                    (step (self,
                                       kindt (node, nil ())),
                                    dot ()))), nil ())),
                        args (lit_str ("is SGML"), nil ())))),
                 locpath
                   (step (descendant-or-self,
                      kindt (node, nil ())),
                   fun_ref (input, nil ()))), empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (locpath
                 (pred
                    (locpath (step (child, namet (section)),
                       dot ()),
                    fun_ref (contains,
                      args
                        (locpath
                           (step (child,
                              kindt (text, nil ())),
                           locpath
                             (step (child, namet (title)),
                             locpath
                               (step (descendant-or-self,
                                  kindt (node, nil ())),
                               locpath
                                 (step (self,
                                    kindt (node, nil ())),
                                 dot ())))),
                        args (lit_str ("is SGML"), nil ())))),
                 locpath
                   (step (descendant-or-self,
                      kindt (node, nil ())),
                   fun_ref (input, nil ()))), empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($id),
                       locpath
                         (step (attribute, namet (xrefid)),
                         locpath
                           (step (child, namet (xref)),
                           locpath
                             (step (descendant-or-self,
                                kindt (node, nil ())),
                             fun_ref (input, nil ()))))),
                    nil ()), nil (), nil (),
                 locpath
                   (pred
                      (locpath (step (child, namet (topic)),
                         dot ()),
                      eq
                        (locpath
                           (step (attribute,
                              namet (topicid)), dot ()),
                        varref ($id))),
                   locpath
                     (step (descendant-or-self,
                        kindt (node, nil ())),
                     fun_ref (input, nil ())))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (result),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (let (nil (), varref ($x),
                       locpath
                         (pred
                            (locpath
                               (step (child, namet (xref)),
                               dot ()),
                            eq
                              (locpath
                                 (step (attribute,
                                    namet (xrefid)),
                                 dot ()), lit_str ("top4"))),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (input, nil ())))),
                    binds
                      (let (nil (), varref ($t),
                         locpath
                           (pred
                              (locpath
                                 (step (child,
                                    namet (title)), dot ()),
                              ltlt
                                (locpath
                                   (step (self,
                                      kindt (node, nil ())),
                                   dot ()), varref ($x))),
                           locpath
                             (step (descendant-or-self,
                                kindt (node, nil ())),
                             fun_ref (input, nil ())))),
                      nil ())), nil (), nil (),
                 pred (varref ($t), fun_ref (last, nil ()))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (locpath
       (pred (locpath (step (child, namet (title)), dot ()),
          fun_ref (contains,
            args
              (locpath (step (child, kindt (text, nil ())),
                 locpath (step (self, kindt (node, nil ())),
                   dot ())),
              args (lit_str ("Foobar Corporation"), nil ())))),
       locpath (step (child, namet (news_item)),
         locpath
           (step (descendant-or-self, kindt (node, nil ())),
           fun_ref (input, nil ())))), empty-seq ()))
--
xquery
  (prolog (nil (),
     fun_decls
       (fun_decl (partners,
          params
            (param (seq_ty (1, atom_ty (xs:string, nil ())),
               varref ($company)), nil ()),
          seq_ty (*, node_ty (element, nil ())),
          exprseq
            (flwr
               (binds
                  (let (nil (), varref ($c),
                     locpath
                       (pred
                          (locpath
                             (step (child, namet (company)),
                             dot ()),
                          eq
                            (locpath
                               (step (child, namet (name)),
                               dot ()), varref ($company))),
                       locpath
                         (step (descendant-or-self,
                            kindt (node, nil ())),
                         fun_ref (document,
                           args
                             (lit_str ("company-data.xml"),
                             nil ()))))), nil ()), nil (),
               nil (),
               locpath (step (child, namet (partner)),
                 locpath
                   (step (descendant-or-self,
                      kindt (node, nil ())), varref ($c)))),
            empty-seq ())), nil ())),
  exprseq
    (flwr
       (binds
          (let (nil (), varref ($foobar_partners),
             fun_ref (partners,
               args (lit_str ("Foobar Corporation"), nil ()))),
          binds
            (bind (nil (), nil (), varref ($item),
               locpath (step (child, namet (news_item)),
                 locpath
                   (step (descendant-or-self,
                      kindt (node, nil ())),
                   fun_ref (input, nil ())))), nil ())),
       or
         (some
            (binds
               (bind (nil (), nil (), varref ($t),
                  locpath (step (child, namet (title)),
                    locpath
                      (step (descendant-or-self,
                         kindt (node, nil ())),
                      varref ($item)))), nil ()),
            exprseq
              (and
                 (fun_ref (contains,
                    args
                      (locpath
                         (step (child,
                            kindt (text, nil ())),
                         varref ($t)),
                      args (lit_str ("Foobar Corporation"),
                        nil ()))),
                 some
                   (binds
                      (bind (nil (), nil (),
                         varref ($partner),
                         varref ($foobar_partners)),
                      nil ()),
                   fun_ref (contains,
                     args
                       (locpath
                          (step (child,
                             kindt (text, nil ())),
                          varref ($t)),
                       args
                         (locpath
                            (step (child,
                               kindt (text, nil ())),
                            varref ($partner)), nil ()))))),
              empty-seq ())),
         some
           (binds
              (bind (nil (), nil (), varref ($par),
                 locpath (step (child, namet (par)),
                   locpath
                     (step (descendant-or-self,
                        kindt (node, nil ())),
                     varref ($item)))), nil ()),
           exprseq
             (and
                (fun_ref (contains,
                   args
                     (fun_ref (string,
                        args (varref ($par), nil ())),
                     args (lit_str ("Foobar Corporation"),
                       nil ()))),
                some
                  (binds
                     (bind (nil (), nil (),
                        varref ($partner),
                        varref ($foobar_partners)), nil ()),
                  fun_ref (contains,
                    args
                      (fun_ref (string,
                         args (varref ($par), nil ())),
                      args
                        (locpath
                           (step (child,
                              kindt (text, nil ())),
                           varref ($partner)), nil ()))))),
             empty-seq ()))), nil (),
       elem (tag (news_item),
         exprseq (empty-seq (),
           exprseq
             (exprseq
                (locpath (step (child, namet (title)),
                   varref ($item)), empty-seq ()),
             exprseq (empty-seq (),
               exprseq
                 (exprseq
                    (locpath (step (child, namet (date)),
                       varref ($item)), empty-seq ()),
                 exprseq (empty-seq (), empty-seq ()))))))),
    empty-seq ()))
--
xquery
  (prolog (nil (),
     fun_decls
       (fun_decl (partners,
          params
            (param (seq_ty (1, atom_ty (xs:string, nil ())),
               varref ($company)), nil ()),
          seq_ty (*, node_ty (element, nil ())),
          exprseq
            (flwr
               (binds
                  (let (nil (), varref ($c),
                     locpath
                       (pred
                          (locpath
                             (step (child, namet (company)),
                             dot ()),
                          eq
                            (locpath
                               (step (child, namet (name)),
                               dot ()), varref ($company))),
                       locpath
                         (step (descendant-or-self,
                            kindt (node, nil ())),
                         fun_ref (document,
                           args
                             (lit_str ("company-data.xml"),
                             nil ()))))), nil ()), nil (),
               nil (),
               locpath (step (child, namet (partner)),
                 locpath
                   (step (descendant-or-self,
                      kindt (node, nil ())), varref ($c)))),
            empty-seq ())), nil ())),
  exprseq
    (flwr
       (binds
          (bind (nil (), nil (), varref ($item),
             locpath (step (child, namet (news_item)),
               locpath
                 (step (descendant-or-self,
                    kindt (node, nil ())),
                 fun_ref (input, nil ())))),
          binds
            (let (nil (), varref ($partners),
               fun_ref (partners,
                 args
                   (locpath (step (child, namet (name)),
                      varref ($c)), nil ()))), nil ())),
       and
         (and
            (fun_ref (contains,
               args
                 (fun_ref (string,
                    args (varref ($item), nil ())),
                 args
                   (locpath (step (child, namet (name)),
                      varref ($c)), nil ()))),
            some
              (binds
                 (bind (nil (), nil (), varref ($p),
                    varref ($partners)), nil ()),
              fun_ref (contains,
                args
                  (fun_ref (string,
                     args (varref ($item), nil ())),
                  args (varref ($p), nil ()))))),
         ne
           (locpath (step (child, namet (news_agent)),
              varref ($item)),
           locpath (step (child, namet (name)), varref ($c)))),
       nil (), varref ($item)), empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (flwr
       (binds
          (bind (nil (), nil (), varref ($item),
             locpath (step (child, namet (news_item)),
               locpath
                 (step (descendant-or-self,
                    kindt (node, nil ())),
                 fun_ref (input, nil ())))), nil ()),
       fun_ref (contains,
         args
           (fun_ref (string,
              args
                (locpath (step (child, namet (content)),
                   varref ($item)), nil ())),
           args (lit_str ("Gorilla Corporation"), nil ()))),
       nil (),
       elem (tag (item_summary),
         exprseq (empty-seq (),
           exprseq
             (exprseq
                (locpath
                   (step (child, kindt (text, nil ())),
                   locpath (step (child, namet (title)),
                     varref ($item))), empty-seq ()),
             exprseq
               (text
                  (exprseq (lit_str (". "), empty-seq ())),
               exprseq
                 (exprseq
                    (locpath
                       (step (child, kindt (text, nil ())),
                       locpath (step (child, namet (date)),
                         varref ($item))), empty-seq ()),
                 exprseq
                   (text
                      (exprseq (lit_str (". "),
                         empty-seq ())),
                   exprseq
                     (exprseq
                        (fun_ref (string,
                           args
                             (pred
                                (exprseq
                                   (locpath
                                      (step (child,
                                         namet (par)),
                                      locpath
                                        (step
                                           (descendant-or-self,
                                           kindt (node,
                                             nil ())),
                                        varref ($item))),
                                   empty-seq ()),
                                lit_int (1)), nil ())),
                        empty-seq ()),
                     exprseq (empty-seq (), empty-seq ()))))))))),
    empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (elem (tag (Q1),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($n),
                       fun_ref (distinct-values,
                         args
                           (flwr
                              (binds
                                 (bind (nil (), nil (),
                                    varref ($i),
                                    exprseq
                                      (union
                                         (locpath
                                            (step (child,
                                               namet (*:*)),
                                            locpath
                                              (step
                                                 (descendant-or-self,
                                                 kindt
                                                   (node,
                                                   nil ())),
                                              fun_ref
                                                (input,
                                                nil ()))),
                                         locpath
                                           (step (attribute,
                                              namet (*:*)),
                                           locpath
                                             (step
                                                (descendant-or-self,
                                                kindt (node,
                                                  nil ())),
                                             fun_ref (input,
                                               nil ())))),
                                      empty-seq ())),
                                 nil ()), nil (), nil (),
                              fun_ref (namespace-uri,
                                args (varref ($i), nil ()))),
                           nil ()))), nil ()), nil (),
                 nil (),
                 elem (tag (ns),
                   exprseq
                     (exprseq (varref ($n), empty-seq ()),
                     empty-seq ()))), empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery
  (prolog
     (decl_imps
        (ns_decl (music,
           lit_str ("http://www.example.org/music/records")),
        nil ()), nil ()),
  exprseq
    (elem (tag (Q2),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (locpath (step (child, namet (music:title)),
                 locpath
                   (step (descendant-or-self,
                      kindt (node, nil ())),
                   fun_ref (input, nil ()))), empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery
  (prolog
     (decl_imps
        (ns_decl (dt,
           lit_str ("http://www.w3.org/2001/XMLSchema")),
        nil ()), nil ()),
  exprseq
    (elem (tag (Q3),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (locpath
                 (pred
                    (locpath (step (child, namet (*:*)),
                       dot ()),
                    locpath (step (attribute, namet (dt:*)),
                      dot ())),
                 locpath
                   (step (descendant-or-self,
                      kindt (node, nil ())),
                   fun_ref (input, nil ()))), empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery
  (prolog
     (decl_imps
        (ns_decl (xlink,
           lit_str ("http://www.w3.org/1999/xlink")),
        nil ()), nil ()),
  exprseq
    (elem (tag (Q4),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($hr),
                       locpath
                         (step (attribute,
                            namet (xlink:href)),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (input, nil ())))),
                    nil ()), nil (), nil (),
                 elem (tag (ns),
                   exprseq
                     (exprseq (varref ($hr), empty-seq ()),
                     empty-seq ()))), empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery
  (prolog
     (decl_imps
        (ns_decl (music,
           lit_str ("http://www.example.org/music/records")),
        nil ()), nil ()),
  exprseq
    (elem (tag (Q5),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (locpath
                 (pred
                    (locpath
                       (step (child, namet (music:record)),
                       dot ()),
                    eq
                      (locpath
                         (step (attribute,
                            namet (xml:lang)),
                         locpath
                           (step (child,
                              namet (music:remark)), dot ())),
                      lit_str ("de"))),
                 locpath
                   (step (descendant-or-self,
                      kindt (node, nil ())),
                   fun_ref (input, nil ()))), empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery
  (prolog
     (decl_imps
        (ns_decl (ma,
           lit_str ("http://www.example.com/AuctionWatch")),
        decl_imps
          (ns_decl (anyzone,
             lit_str
               ("http://www.example.com/auctioneers#anyzone")),
          nil ())), nil ()),
  exprseq
    (elem (tag (Q6),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (locpath (step (child, namet (ma:Close)),
                 locpath (step (child, namet (ma:Schedule)),
                   locpath
                     (pred
                        (locpath
                           (step (child,
                              namet (ma:Auction)), dot ()),
                        locpath
                          (step (attribute,
                             namet (anyzone:ID)), dot ())),
                     locpath
                       (step (descendant-or-self,
                          kindt (node, nil ())),
                       fun_ref (input, nil ()))))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery
  (prolog
     (decl_imps
        (ns_decl (ma,
           lit_str ("http://www.example.com/AuctionWatch")),
        nil ()), nil ()),
  exprseq
    (elem (tag (Q7),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($a),
                       locpath
                         (step (child, namet (ma:Auction)),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (document,
                             args
                               (lit_str
                                  ("data/ns-data.xml"),
                               nil ()))))),
                    binds
                      (let (nil (), varref ($seller_id),
                         locpath
                           (step (child, namet (*:ID)),
                           locpath
                             (step (child,
                                namet (ma:Seller)),
                             locpath
                               (step (child,
                                  namet
                                    (ma:Trading_Partners)),
                               varref ($a))))),
                      binds
                        (let (nil (), varref ($buyer_id),
                           locpath
                             (step (child, namet (*:ID)),
                             locpath
                               (step (child,
                                  namet (ma:High_Bidder)),
                               locpath
                                 (step (child,
                                    namet
                                      (ma:Trading_Partners)),
                                 varref ($a))))), nil ()))),
                 eq
                   (fun_ref (namespace-uri,
                      args (varref ($seller_id), nil ())),
                   fun_ref (namespace-uri,
                     args (varref ($buyer_id), nil ()))),
                 nil (),
                 locpath
                   (step (child,
                      namet (ma:AuctionHomepage)),
                   varref ($a))), empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery
  (prolog
     (decl_imps
        (ns_decl (ma,
           lit_str ("http://www.example.com/AuctionWatch")),
        nil ()), nil ()),
  exprseq
    (elem (tag (Q8),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($s),
                       locpath
                         (exprseq
                            (union
                               (locpath
                                  (step (child,
                                     namet (ma:Seller)),
                                  dot ()),
                               locpath
                                 (step (child,
                                    namet (ma:High_Bidder)),
                                 dot ())), empty-seq ()),
                         locpath
                           (step (child,
                              namet (ma:Trading_Partners)),
                           locpath
                             (step (descendant-or-self,
                                kindt (node, nil ())),
                             fun_ref (input, nil ()))))),
                    nil ()),
                 eq
                   (locpath
                      (step (child,
                         namet (*:NegativeComments)),
                      varref ($s)), lit_int (0)), nil (),
                 varref ($s)), empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery
  (prolog (nil (),
     fun_decls
       (fun_decl (one_level,
          params
            (param (seq_ty (1, node_ty (element, nil ())),
               varref ($p)), nil ()),
          seq_ty (1, node_ty (element, nil ())),
          exprseq
            (elem (tag (part),
               exprseq
                 (attr (tag (partid),
                    exprseq
                      (exprseq
                         (locpath
                            (step (attribute,
                               namet (partid)),
                            varref ($p)), empty-seq ()),
                      empty-seq ())),
                 exprseq
                   (attr (tag (name),
                      exprseq
                        (exprseq
                           (locpath
                              (step (attribute,
                                 namet (name)),
                              varref ($p)), empty-seq ()),
                        empty-seq ())),
                   exprseq (empty-seq (),
                     exprseq
                       (exprseq
                          (flwr
                             (binds
                                (bind (nil (), nil (),
                                   varref ($s),
                                   locpath
                                     (step (child,
                                        namet (part)),
                                     locpath
                                       (step
                                          (descendant-or-self,
                                          kindt (node,
                                            nil ())),
                                       fun_ref (document,
                                         args
                                           (lit_str
                                              ("partlist.xml"),
                                           nil ()))))),
                                nil ()),
                             eq
                               (locpath
                                  (step (attribute,
                                     namet (partof)),
                                  varref ($s)),
                               locpath
                                 (step (attribute,
                                    namet (partid)),
                                 varref ($p))), nil (),
                             fun_ref (one_level,
                               args (varref ($s), nil ()))),
                          empty-seq ()),
                       exprseq (empty-seq (), empty-seq ())))))),
            empty-seq ())), nil ())),
  exprseq
    (elem (tag (parttree),
       exprseq (empty-seq (),
         exprseq
           (exprseq
              (flwr
                 (binds
                    (bind (nil (), nil (), varref ($p),
                       locpath
                         (pred
                            (locpath
                               (step (child, namet (part)),
                               dot ()),
                            fun_ref (empty,
                              args
                                (locpath
                                   (step (attribute,
                                      namet (partof)),
                                   dot ()), nil ()))),
                         locpath
                           (step (descendant-or-self,
                              kindt (node, nil ())),
                           fun_ref (document,
                             args (lit_str ("partlist.xml"),
                               nil ()))))), nil ()), nil (),
                 nil (),
                 fun_ref (one_level,
                   args (varref ($p), nil ()))),
              empty-seq ()),
           exprseq (empty-seq (), empty-seq ())))),
    empty-seq ()))
--
xquery
  (prolog
     (decl_imps (schm_imp (lit_str ("ipo.xsd"), nil ()),
        decl_imps
          (ns_decl (ipo,
             lit_str ("http://www.example.com/IPO")),
          nil ())), nil ()),
  exprseq
    (fun_ref (count,
       args
         (locpath
            (pred
               (locpath (step (child, namet (ipo:shipTo)),
                  dot ()),
               instof
                 (locpath
                    (step (self, kindt (node, nil ())),
                    dot ()),
                 seq_ty (1,
                   node_ty (element,
                     req_ty (nil (),
                       named_ty (ipo:UKAddress)))))),
            locpath
              (step (descendant-or-self,
                 kindt (node, nil ())),
              fun_ref (document,
                args (lit_str ("ipo.xml"), nil ())))),
         nil ())), empty-seq ()))
--
xquery
  (prolog
     (decl_imps (schm_imp (lit_str ("ipo.xsd"), nil ()),
        decl_imps (schm_imp (lit_str ("zips.xsd"), nil ()),
          decl_imps
            (ns_decl (ipo,
               lit_str ("http://www.example.com/IPO")),
            decl_imps
              (ns_decl (zips,
                 lit_str ("http://www.example.com/zips")),
              nil ())))),
     fun_decls
       (fun_decl (zip-ok,
          params
            (param
               (seq_ty (1,
                  node_ty (element,
                    req_ty (nil (),
                      named_ty (ipo:USAddress)))),
               varref ($a)), nil ()),
          seq_ty (1, atom_ty (xs:boolean, nil ())),
          exprseq
            (and
               (and
                  (some
                     (binds
                        (bind (nil (), nil (), varref ($i),
                           locpath
                             (step (child,
                                namet (zips:row)),
                             locpath
                               (step (child,
                                  namet (zips:zips)),
                               fun_ref (document,
                                 args (lit_str ("zips.xml"),
                                   nil ()))))), nil ()),
                     eq
                       (locpath
                          (step (child, namet (zips:city)),
                          varref ($i)),
                       locpath
                         (step (child, namet (ipo:city)),
                         varref ($a)))),
                  eq
                    (locpath
                       (step (child, namet (zips:state)),
                       varref ($i)),
                    locpath
                      (step (child, namet (ipo:state)),
                      varref ($a)))),
               eq
                 (locpath (step (child, namet (zips:zip)),
                    varref ($i)),
                 locpath (step (child, namet (ipo:zip)),
                   varref ($a)))), empty-seq ())), nil ())),
  empty-seq ())
--
xquery
  (prolog
     (decl_imps (schm_imp (lit_str ("ipo.xsd"), nil ()),
        decl_imps
          (schm_imp (lit_str ("postals.xsd"), nil ()),
          decl_imps
            (ns_decl (ipo,
               lit_str ("http://www.example.com/IPO")),
            decl_imps
              (ns_decl (pst,
                 lit_str ("http://www.example.com/postals")),
              nil ())))),
     fun_decls
       (fun_decl (postal-ok,
          params
            (param
               (seq_ty (1,
                  node_ty (element,
                    req_ty (nil (),
                      named_ty (ipo:UKAddress)))),
               varref ($a)), nil ()),
          seq_ty (1, atom_ty (xs:boolean, nil ())),
          exprseq
            (and
               (some
                  (binds
                     (bind (nil (), nil (), varref ($i),
                        locpath
                          (step (child, namet (pst:row)),
                          locpath
                            (step (child,
                               namet (pst:postals)),
                            fun_ref (document,
                              args (lit_str ("postals.xml"),
                                nil ()))))), nil ()),
                  eq
                    (locpath
                       (step (child, namet (pst:city)),
                       varref ($i)),
                    locpath (step (child, namet (ipo:city)),
                      varref ($a)))),
               fun_ref (xf:starts-with,
                 args
                   (locpath
                      (step (child, namet (ipo:postcode)),
                      varref ($a)),
                   args
                     (locpath
                        (step (child, namet (pst:prefix)),
                        varref ($i)), nil ())))),
            empty-seq ())), nil ())), empty-seq ())
--
xquery
  (prolog
     (decl_imps (schm_imp (lit_str ("ipo.xsd"), nil ()),
        decl_imps
          (schm_imp (lit_str ("postals.xsd"), nil ()),
          decl_imps
            (schm_imp (lit_str ("zips.xsd"), nil ()),
            decl_imps
              (ns_decl (ipo,
                 lit_str ("http://www.example.com/IPO")),
              decl_imps
                (ns_decl (pst,
                   lit_str
                     ("http://www.example.com/postals")),
                decl_imps
                  (ns_decl (zips,
                     lit_str ("http://www.example.com/zips")),
                  nil ())))))),
     fun_decls
       (fun_decl (postal-ok,
          params
            (param
               (seq_ty (1,
                  node_ty (element,
                    req_ty (nil (),
                      named_ty (ipo:UKAddress)))),
               varref ($a)), nil ()),
          seq_ty (1, atom_ty (xs:boolean, nil ())),
          exprseq
            (and
               (some
                  (binds
                     (bind (nil (), nil (), varref ($i),
                        locpath
                          (step (child, namet (pst:row)),
                          locpath
                            (step (child,
                               namet (pst:postals)),
                            fun_ref (document,
                              args (lit_str ("postals.xml"),
                                nil ()))))), nil ()),
                  eq
                    (locpath
                       (step (child, namet (pst:city)),
                       varref ($i)),
                    locpath (step (child, namet (ipo:city)),
                      varref ($a)))),
               fun_ref (starts-with,
                 args
                   (locpath
                      (step (child, namet (ipo:postcode)),
                      varref ($a)),
                   args
                     (locpath
                        (step (child, namet (pst:prefix)),
                        varref ($i)), nil ())))),
            empty-seq ())),
       fun_decls
         (fun_decl (zip-ok,
            params
              (param
                 (seq_ty (1,
                    node_ty (element,
                      req_ty (nil (),
                        named_ty (ipo:USAddress)))),
                 varref ($a)), nil ()),
            seq_ty (1, atom_ty (xs:boolean, nil ())),
            exprseq
              (and
                 (and
                    (some
                       (binds
                          (bind (nil (), nil (),
                             varref ($i),
                             locpath
                               (step (child,
                                  namet (zips:row)),
                               locpath
                                 (step (child,
                                    namet (zips:zips)),
                                 fun_ref (document,
                                   args
                                     (lit_str ("zips.xml"),
                                     nil ()))))), nil ()),
                       eq
                         (locpath
                            (step (child,
                               namet (zips:city)),
                            varref ($i)),
                         locpath
                           (step (child, namet (ipo:city)),
                           varref ($a)))),
                    eq
                      (locpath
                         (step (child, namet (zips:state)),
                         varref ($i)),
                      locpath
                        (step (child, namet (ipo:state)),
                        varref ($a)))),
                 eq
                   (locpath (step (child, namet (zips:zip)),
                      varref ($i)),
                   locpath (step (child, namet (ipo:zip)),
                     varref ($a)))), empty-seq ())),
         fun_decls
           (fun_decl (address-ok,
              params
                (param
                   (seq_ty (1,
                      node_ty (element,
                        req_ty (nil (),
                          named_ty (ipo:Address)))),
                   varref ($a)), nil ()),
              seq_ty (1, atom_ty (xs:boolean, nil ())),
              exprseq
                (typeswitch (varref ($a),
                   cases
                     (case
                        (seq_ty (1,
                           node_ty (element,
                             req_ty (nil (),
                               named_ty (ipo:USAddress)))),
                        varref ($zip),
                        fun_ref (zip-ok,
                          args (varref ($zip), nil ()))),
                     cases
                       (case
                          (seq_ty (1,
                             node_ty (element,
                               req_ty (nil (),
                                 named_ty (ipo:UKAddress)))),
                          varref ($postal),
                          fun_ref (postal-ok,
                            args (varref ($postal), nil ()))),
                       nil ())), nil (),
                   fun_ref (false, nil ())), empty-seq ())),
           nil ())))),
  exprseq
    (flwr
       (binds
          (bind (nil (), nil (), varref ($p),
             locpath
               (step (child, namet (ipo:purchaseOrder)),
               locpath
                 (step (descendant-or-self,
                    kindt (node, nil ())),
                 fun_ref (document,
                   args (lit_str ("ipo.xml"), nil ()))))),
          nil ()),
       fun_ref (not,
         args
           (and
              (fun_ref (address-ok,
                 args
                   (locpath
                      (step (child, namet (ipo:shipTo)),
                      varref ($p)), nil ())),
              fun_ref (address-ok,
                args
                  (locpath
                     (step (child, namet (ipo:billTo)),
                     varref ($p)), nil ()))), nil ())),
       nil (), varref ($p)), empty-seq ()))
--
xquery
  (prolog
     (decl_imps (schm_imp (lit_str ("ipo.xsd"), nil ()),
        decl_imps
          (ns_decl (ipo,
             lit_str ("http://www.example.com/IPO")),
          nil ())),
     fun_decls
       (fun_decl (names-match,
          params
            (param
               (seq_ty (1,
                  node_ty (element,
                    req_ty (req_name (ipo:shipTo),
                      schm_path
                        (glob_schm (ipo:purchaseOrder),
                        nil ())))), varref ($s)),
            params
              (param
                 (seq_ty (1,
                    node_ty (element,
                      req_ty (req_name (ipo:billTo),
                        schm_path
                          (glob_schm (ipo:purchaseOrder),
                          nil ())))), varref ($b)), nil ())),
          seq_ty (1, atom_ty (xs:boolean, nil ())),
          exprseq
            (eq
               (locpath (step (child, namet (ipo:name)),
                  varref ($s)),
               locpath (step (child, namet (ipo:name)),
                 varref ($b))), empty-seq ())), nil ())),
  exprseq
    (flwr
       (binds
          (bind (nil (), nil (), varref ($p),
             locpath
               (step (child, namet (ipo:purchaseOrder)),
               locpath
                 (step (descendant-or-self,
                    kindt (node, nil ())),
                 fun_ref (document,
                   args (lit_str ("ipo.xml"), nil ()))))),
          nil ()),
       fun_ref (not,
         args
           (fun_ref (names-match,
              args
                (locpath (step (child, namet (ipo:shipTo)),
                   varref ($p)),
                args
                  (locpath
                     (step (child, namet (ipo:billTo)),
                     varref ($p)), nil ()))), nil ())),
       nil (), varref ($p)), empty-seq ()))
--
xquery
  (prolog
     (decl_imps (schm_imp (lit_str ("ipo.xsd"), nil ()),
        decl_imps
          (ns_decl (ipo,
             lit_str ("http://www.example.com/IPO")),
          nil ())), nil ()),
  exprseq
    (flwr
       (binds
          (bind (nil (), nil (), varref ($p),
             locpath
               (step (child, namet (ipo:purchaseOrder)),
               locpath
                 (step (descendant-or-self,
                    kindt (node, nil ())),
                 fun_ref (document,
                   args (lit_str ("ipo.xml"), nil ()))))),
          binds
            (bind (nil (), nil (), varref ($s),
               locpath (step (child, namet (ipo:shipTo)),
                 varref ($p))), nil ())),
       and
         (fun_ref (not,
            args
              (instof (varref ($s),
                 seq_ty (1,
                   node_ty (element,
                     req_ty (nil (),
                       named_ty (ipo:USAddress))))), nil ())),
         fun_ref (exists,
           args
             (locpath (step (child, namet (ipo:USPrice)),
                locpath
                  (step (descendant-or-self,
                     kindt (node, nil ())), varref ($p))),
             nil ()))), nil (), varref ($p)), empty-seq ()))
--
xquery
  (prolog
     (decl_imps (schm_imp (lit_str ("ipo.xsd"), nil ()),
        decl_imps
          (ns_decl (ipo,
             lit_str ("http://www.example.com/IPO")),
          nil ())),
     fun_decls
       (fun_decl (comment-text,
          params
            (param
               (seq_ty (1,
                  node_ty (element,
                    req_ty (req_name (ipo:comment), nil ()))),
               varref ($c)), nil ()),
          seq_ty (1, atom_ty (xs:string, nil ())),
          exprseq
            (fun_ref (string, args (varref ($c), nil ())),
            empty-seq ())), nil ())),
  exprseq
    (flwr
       (binds
          (bind (nil (), nil (), varref ($p),
             locpath
               (step (child, namet (ipo:purchaseOrder)),
               locpath
                 (step (descendant-or-self,
                    kindt (node, nil ())),
                 fun_ref (document,
                   args (lit_str ("ipo.xml"), nil ()))))),
          binds
            (bind (nil (), nil (), varref ($t),
               fun_ref (comment-text,
                 args
                   (locpath
                      (step (child,
                         namet (ipo:shipComment)),
                      locpath
                        (step (descendant-or-self,
                           kindt (node, nil ())),
                        varref ($p))), nil ()))), nil ())),
       and
         (eq
            (locpath (step (child, namet (ipo:name)),
               locpath (step (child, namet (ipo:shipTo)),
                 varref ($p))), lit_str ("Helen Zoe")),
         eq
           (locpath (step (child, namet (ipo:orderDate)),
              varref ($p)),
           fun_ref (date,
             args (lit_str ("1999-12-01"), nil ())))),
       nil (), varref ($t)), empty-seq ()))
--
xquery (prolog (nil (), nil ()),
  exprseq
    (flwr
       (binds
          (bind (nil (), nil (), varref ($p),
             locpath
               (step (child, namet (ipo:purchaseOrder)),
               locpath
                 (step (descendant-or-self,
                    kindt (node, nil ())),
                 fun_ref (document,
                   args (lit_str ("ipo.xml"), nil ()))))),
          nil ()),
       and
         (eq
            (locpath (step (child, namet (ipo:name)),
               locpath (step (child, namet (ipo:shipTo)),
                 varref ($p))), lit_str ("Helen Zoe")),
         eq
           (locpath (step (attribute, namet (orderDate)),
              varref ($p)),
           fun_ref (date,
             args (lit_str ("1999-12-01"), nil ())))),
       nil (),
       fun_ref (comment-text,
         args
           (locpath
              (step (child, namet (ipo:customerComment)),
              locpath
                (step (descendant-or-self,
                   kindt (node, nil ())), varref ($p))),
           nil ()))), empty-seq ()))
--
xquery
  (prolog
     (decl_imps (schm_imp (lit_str ("ipo.xsd"), nil ()),
        decl_imps
          (ns_decl (ipo,
             lit_str ("http://www.example.com/IPO")),
          nil ())), nil ()),
  exprseq
    (flwr
       (binds
          (bind (nil (), nil (), varref ($p),
             locpath
               (step (child, namet (ipo:purchaseOrder)),
               locpath
                 (step (descendant-or-self,
                    kindt (node, nil ())),
                 fun_ref (document,
                   args (lit_str ("ipo.xml"), nil ()))))),
          nil ()),
       and
         (eq
            (locpath (step (child, namet (ipo:name)),
               locpath (step (child, namet (ipo:shipTo)),
                 varref ($p))), lit_str ("Helen Zoe")),
         eq
           (locpath (step (attribute, namet (orderDate)),
              varref ($p)),
           fun_ref (date,
             args (lit_str ("1999-12-01"), nil ())))),
       nil (),
       exprseq
         (union
            (union
               (locpath
                  (step (child,
                     namet (ipo:customerComment)),
                  locpath
                    (step (descendant-or-self,
                       kindt (node, nil ())), varref ($p))),
               locpath
                 (step (child, namet (ipo:shipComment)),
                 locpath
                   (step (descendant-or-self,
                      kindt (node, nil ())), varref ($p)))),
            locpath (step (child, namet (ipo:comment)),
              locpath
                (step (descendant-or-self,
                   kindt (node, nil ())), varref ($p)))),
         empty-seq ())), empty-seq ()))
--
xquery
  (prolog
     (decl_imps (schm_imp (lit_str ("ipo.xsd"), nil ()),
        decl_imps
          (ns_decl (ipo,
             lit_str ("http://www.example.com/IPO")),
          nil ())),
     fun_decls
       (fun_decl (comments-for-element,
          params
            (param (seq_ty (1, node_ty (element, nil ())),
               varref ($e)), nil ()),
          seq_ty (*, atom_ty (ipo:comment, nil ())),
          exprseq
            (flwr
               (binds
                  (let (nil (), varref ($c),
                     locpath
                       (exprseq
                          (union
                             (union
                                (locpath
                                   (step (child,
                                      namet
                                        (ipo:customerComment)),
                                   dot ()),
                                locpath
                                  (step (child,
                                     namet (ipo:shipComment)),
                                  dot ())),
                             locpath
                               (step (child,
                                  namet (ipo:comment)),
                               dot ())), empty-seq ()),
                       varref ($e))), nil ()), nil (),
               nil (), varref ($c)), empty-seq ())), nil ())),
  empty-seq ())
--
xquery
  (prolog
     (decl_imps (schm_imp (lit_str ("ipo.xsd"), nil ()),
        decl_imps
          (ns_decl (ipo,
             lit_str ("http://www.example.com/IPO")),
          nil ())),
     fun_decls
       (fun_decl (deadbeat,
          params
            (param
               (seq_ty (1,
                  node_ty (element,
                    req_ty (req_name (ipo:billTo),
                      named_ty (ipo:USAddress)))),
               varref ($b)), nil ()),
          seq_ty (1, atom_ty (xs:boolean, nil ())),
          exprseq
            (eq
               (locpath (step (child, namet (ipo:name)),
                  varref ($b)),
               locpath (step (child, namet (name)),
                 locpath (step (child, namet (row)),
                   locpath (step (child, namet (deadbeats)),
                     fun_ref (document,
                       args
                         (lit_str
                            ("http://www.usa-deadbeats.com/current"),
                         nil ())))))), empty-seq ())),
       nil ())), empty-seq ())
--
xquery
  (prolog
     (decl_imps (schm_imp (lit_str ("ipo.xsd"), nil ()),
        decl_imps
          (ns_decl (ipo,
             lit_str ("http://www.example.com/IPO")),
          nil ())),
     fun_decls
       (fun_decl (total-price,
          params
            (param
               (seq_ty (*,
                  node_ty (element,
                    req_ty (req_name (ipo:item), nil ()))),
               varref ($i)), nil ()),
          seq_ty (1, atom_ty (xs:decimal, nil ())),
          exprseq
            (flwr
               (binds
                  (let (nil (), varref ($subtotals),
                     flwr
                       (binds
                          (bind (nil (), nil (),
                             varref ($s), varref ($i)),
                          nil ()), nil (), nil (),
                       mult
                         (locpath
                            (step (child,
                               namet (ipo:quantity)),
                            varref ($s)),
                         locpath
                           (step (child,
                              namet (ipo:USPrice)),
                           varref ($s))))), nil ()), nil (),
               nil (),
               fun_ref (sum,
                 args (varref ($subtotals), nil ()))),
            empty-seq ())), nil ())), empty-seq ())
--
xquery
  (prolog
     (decl_imps (schm_imp (lit_str ("ipo.xsd"), nil ()),
        decl_imps
          (ns_decl (ipo,
             lit_str ("http://www.example.com/IPO")),
          nil ())), nil ()),
  exprseq
    (flwr
       (binds
          (bind (nil (), nil (), varref ($p),
             locpath
               (step (child, namet (ipo:purchaseOrder)),
               locpath
                 (step (descendant-or-self,
                    kindt (node, nil ())),
                 fun_ref (document,
                   args (lit_str ("ipo.xml"), nil ()))))),
          nil ()),
       and
         (eq
            (locpath (step (child, namet (ipo:name)),
               locpath (step (child, namet (ipo:shipTo)),
                 varref ($p))), lit_str ("Helen Zoe")),
         eq
           (locpath (step (child, namet (ipo:orderDate)),
              varref ($p)),
           fun_ref (date,
             args (lit_str ("1999-12-01"), nil ())))),
       nil (),
       fun_ref (total-price,
         args
           (locpath (step (child, namet (ipo:item)),
              locpath
                (step (descendant-or-self,
                   kindt (node, nil ())), varref ($p))),
           nil ()))), empty-seq ()))