# Monet Mil to Mal compiler
# Copyright (c) 2001-2004, CWI. All rights reserved.

# Predefined code segment
#The compiler can not guarantee an accurate compilation,
#because MIL unlike MAL is a dynamically typed language.
#A few guidelines to maximize usefullness.
#- make the type of variables explicit, in particular 'nil'
#- upon advice of M2m to remap identifiers, change it in your program directly
#var k1 := new(void,int,1000);
	k1 := new(:void,:int,1000);
#var i := 0;
	i := 0;
#while(i < 1000) {
barrier	aa_a := true;
barrier	ba_a := <(i,1000);
#        k1.insert(nil,i);
	nil:= mil.take("nil");
	ca_a := insert(k1,nil,i);
redo	aa_a;
exit	ba_a;
exit	aa_a;
#var m1 := new(void,int,1000000);
	m1 := new(:void,:int,1000000);
#i := 0;
	i := 0;
#while(i < 1000) {
barrier	da_a := true;
barrier	ea_a := <(i,1000);
#        m1.insert(k1);
	fa_a := insert(m1,k1);
redo	da_a;
exit	ea_a;
exit	da_a;
#m1.seqbase(0@0);
	ga_a := bat.setSequenceBase(m1,0@0);
#dir("tmp");
	ha_a := dir("tmp");
#i := 0;
	i := 0;
#mem_maxsize(lng(10*1024*1024));
	ia_a := *(1024,1024);
	ja_a := *(10,ia_a);
	ka_a := lng(ja_a);
	la_a := mem_maxsize(ka_a);
#while(i < 10) {
barrier	ma_a := true;
barrier	na_a := <(i,10);
#	print("DIR");
	oa_a := print("DIR");
#	dir("b_");
	pa_a := dir("b_");
#        print("COPY");
	qa_a := print("COPY");
#        var b := m1.copy().rename(sprintf("b_%d",i :+= 1));
	ra_a := sprintf("b_%d",i);
	sa_a := copy(m1,);
	b := bat.setName(sa_a,ra_a);
#        b.persists(true).commit();
	ta_a := persists(b,true);
	ua_a := commit(ta_a,);
redo	ma_a;
exit	na_a;
exit	ma_a;
function countall(,countall:any...):void;
#  var i := 0;
	i := 0;
#  while(i < $0) {
barrier	va_a := true;
barrier	wa_a := <(i,$0);
#     $(i).count().print();
	xa_a := mil.getVarTemp(i);
	ya_a := count(xa_a,);
	ab_a := print(ya_a,);
redo	va_a;
exit	wa_a;
exit	va_a;
end countall;
#dir("b_");
	bb_a := dir("b_");
#countall(bat("b_1"),bat("b_2"),bat("b_3"),bat("b_4"));
	cb_a := new("b_1");
	db_a := new("b_2");
	eb_a := new("b_3");
	fb_a := new("b_4");
	gb_a := countall(cb_a,db_a,eb_a,fb_a);
#dir("b_");
	hb_a := dir("b_");
#quit();
	ib_a := quit();
#Identifer 'rename' mapped to 'bat.setName'
#Identifer 'seqbase' mapped to 'bat.setSequenceBase'
