# Monet Database Server V5.0
# Copyright (c) 1993-2003, CWI. All rights reserved.
# compiled for 32biti686-pc-linux-gnu/32bit.
# config:/ufs/mk/monet_5/src/mal/Tests/tst.conf
# dbfarm:/ufs/mk/monet_5/Linux/var/MonetDB
# dbname:demo
#	t:= new(int, url);
#	cb_a := url("http://www.cwi.nl");
#	db_a := insert(t,1,cb_a);
#        eb_a := url("http://www.cwi.nl/~monet");
#        fb_a := insert(t,2,eb_a);
#	gb_a := url("http://www.cwi.nl/~mk/Acoi/doc/features.html");
#        hb_a := insert(t,3,gb_a);
#        ib_a := url("http://www.educ.uva.nl/schoolweb/rocloka.htm");
#        jb_a := insert(t,4,ib_a);
#        kb_a := url("http://www.nedstat.nl/cgi-bin/viewstat?name=Planetarium");
#        lb_a := insert(t,5,kb_a);
#        mb_a := url("http://www.edgeonline.com/");
#        nb_a := insert(t,6,mb_a);
#        ob_a := url("http://robotics.stanford.edu/icons/ ");
#        pb_a := insert(t,7,ob_a);
#	qb_a := print("build a table finished");
#	print(t);
#
#        rb:= new(int,url);
#	print("start loop");
## Drop this line and you get a segmentation fault
#barrier mloop:lng := bbp.bunStream(t,h:int,B2:url);
#	print(B2);
#	redo mloop;
#exit mloop;
#
#        print(rb);
#
#
function Admin.main():int; #0  (main:int)
    t := bbp.new(int,url); #1 CMDBATnew (t:bat[int,url])<-(int:int)(url:url)
    cb_a := url.url("http://www.cwi.nl"); #2 URLnew (cb_a:url)<-($5:str)
    db_a := bat.insert(t,1,cb_a); #3 CMDinsert_bun (db_a:void)<-(t:bat[int,url])($7:int)(cb_a:url)
    eb_a := url.url("http://www.cwi.nl/~monet"); #4 URLnew (eb_a:url)<-($9:str)
    fb_a := bat.insert(t,2,eb_a); #5 CMDinsert_bun (fb_a:void)<-(t:bat[int,url])($11:int)(eb_a:url)
    gb_a := url.url("http://www.cwi.nl/~mk/Acoi/doc/features.html"); #6 URLnew (gb_a:url)<-($13:str)
    hb_a := bat.insert(t,3,gb_a); #7 CMDinsert_bun (hb_a:void)<-(t:bat[int,url])($15:int)(gb_a:url)
    ib_a := url.url("http://www.educ.uva.nl/schoolweb/rocloka.htm"); #8 URLnew (ib_a:url)<-($17:str)
    jb_a := bat.insert(t,4,ib_a); #9 CMDinsert_bun (jb_a:void)<-(t:bat[int,url])($19:int)(ib_a:url)
    kb_a := url.url("http://www.nedstat.nl/cgi-bin/viewstat?name=Planetarium"); #10 URLnew (kb_a:url)<-($21:str)
    lb_a := bat.insert(t,5,kb_a); #11 CMDinsert_bun (lb_a:void)<-(t:bat[int,url])($23:int)(kb_a:url)
    mb_a := url.url("http://www.edgeonline.com/"); #12 URLnew (mb_a:url)<-($25:str)
    nb_a := bat.insert(t,6,mb_a); #13 CMDinsert_bun (nb_a:void)<-(t:bat[int,url])($27:int)(mb_a:url)
    ob_a := url.url("http://robotics.stanford.edu/icons/ "); #14 URLnew (ob_a:url)<-($29:str)
    pb_a := bat.insert(t,7,ob_a); #15 CMDinsert_bun (pb_a:void)<-(t:bat[int,url])($31:int)(ob_a:url)
    qb_a := io.print("build a table finished"); #16 CMDprint_val (qb_a:int)<-($33:str)
    io.print(t); #17 CMDprint_val ($34:int)<-(t:bat[int,url])
    rb := bbp.new(int,url); #18 CMDBATnew (rb:bat[int,url])<-(int:int)(url:url)
    io.print("start loop"); #19 CMDprint_val ($36:int)<-($37:str)
barrier mloop := bbp.bunStream(t,h,B2); #20 CMDbunStream (mloop:lng)<-(t:bat[int,url])(h:int)(B2:url) jump 23
    io.print(B2); #21 CMDprint_val ($41:int)<-(B2:url)
    redo mloop; #22  (mloop:lng) jump 20
exit mloop; #23  (mloop:lng)
    io.print(rb); #24 CMDprint_val ($42:int)<-(rb:bat[int,url])
end main; #25  
[ "build a table finished" ]
#-------------------------------------------------------------------------#
# BAT:	  tmp_4								  #
# (int)	  (url)								  #
#-------------------------------------------------------------------------#
[ 1,	  "http://www.cwi.nl"						  ]
[ 2,	  "http://www.cwi.nl/~monet"					  ]
[ 3,	  "http://www.cwi.nl/~mk/Acoi/doc/features.html"		  ]
[ 4,	  "http://www.educ.uva.nl/schoolweb/rocloka.htm"		  ]
[ 5,	  "http://www.nedstat.nl/cgi-bin/viewstat?name=Planetarium"	  ]
[ 6,	  "http://www.edgeonline.com/"					  ]
[ 7,	  "http://robotics.stanford.edu/icons/ "			  ]
[ "start loop" ]
[ "http://www.cwi.nl" ]
[ "http://www.cwi.nl/~monet" ]
[ "http://www.cwi.nl/~mk/Acoi/doc/features.html" ]
[ "http://www.educ.uva.nl/schoolweb/rocloka.htm" ]
[ "http://www.nedstat.nl/cgi-bin/viewstat?name=Planetarium" ]
[ "http://www.edgeonline.com/" ]
[ "http://robotics.stanford.edu/icons/ " ]
#-----------------#
# BAT:	  tmp_5	  #
# (int)	  (url)	  #
#-----------------#
>