# Monet Database Server V5.0
# Copyright (c) 1993-2003, CWI. All rights reserved.
# compiled for 32biti686-pc-linux-gnu/32bit.
# config:/ufs/mk/monet_5/src/mal/Tests/tst.conf
# dbfarm:/ufs/mk/monet_5/Linux/var/MonetDB
# dbname:demo
##test debugging of a recursive function
#
#function test(age:int,nme:str):int;
#	printf("simulated error\n");
#	c:= stkDepth();
#	printf("depth %d\n",c);
#	t:= catalog.stkFrame();
#	print(t);
#	d:= symbolDump();
#	print(d);
#	t:= catalog.stkFrame(c);
#	print(t);
#	v:= catalog.varUsed();
#	print(v);
#	w:= catalog.varConstant();
#	print(w);
#end test;
function Admin.test(age:int,nme:str):int; #0  (test:int)<-(age:int)(nme:str)
    system.printf("simulated error\n"); #1 SYSprint_str ($3:int)<-($4:str)
    c := catalog.stkDepth(); #2 CATALOGStkDepth (c:int)
    system.printf("depth %d\n",c); #3 SYSprint_formatted_int ($6:int)<-($7:str)(c:int)
    t := catalog.stkFrame(); #4 CATALOGStkFrame (t:bat[str,str])
    io.print(t); #5 CMDprint_val ($9:int)<-(t:bat[str,str])
    d := catalog.symbolDump(); #6 CATALOGsymbolDump (d:bat[void,str])
    io.print(d); #7 CMDprint_val ($11:int)<-(d:bat[void,str])
    t := catalog.stkFrame(c); #8 CATALOGStkFrameN (t:bat[str,str])<-(c:int)
    io.print(t); #9 CMDprint_val ($12:int)<-(t:bat[str,str])
    v := catalog.varUsed(); #10 CATALOGVarUsed (v:bat[str,str])
    io.print(v); #11 CMDprint_val ($14:int)<-(v:bat[str,str])
    w := catalog.varConstant(); #12 CATALOGVarConstant (w:bat[str,str])
    io.print(w); #13 CMDprint_val ($16:int)<-(w:bat[str,str])
end test; #14  
#test(12,"jj");
#
function Admin.main():int; #0  (main:int)
    Admin.test(12,"jj"); #1  ($1:int)<-($2:int)($3:str)
end main; #2  
simulated error
depth 2
#-----------------------------------------#
# BAT:	  frame				  #
# (str)	  (str)				  #
#-----------------------------------------#
[ "test", "0@0"				  ]
[ "age",  "12"				  ]
[ "nme",  "\"jj\""			  ]
[ "$3",	  "1"				  ]
[ "$4",	  "\"simulated error\\\\n\""	  ]
[ "c",	  "2"				  ]
[ "$6",	  "1"				  ]
[ "$7",	  "\"depth %d\\\\n\""		  ]
[ "t",	  "<frame>"			  ]
[ "$9",	  "0"				  ]
[ "d",	  "nil"				  ]
[ "$11",  "0"				  ]
[ "$12",  "0"				  ]
[ "v",	  "nil"				  ]
[ "$14",  "0"				  ]
[ "w",	  "nil"				  ]
[ "$16",  "0"				  ]
#---------------------------------------------------------#
# BAT:	  stmt						  #
# (void)  (str)						  #
#---------------------------------------------------------#
[ nil,	  "function Admin.test(age:int,nme:str):int;"	  ]
[ nil,	  "    system.printf(\"simulated error\\n\");"	  ]
[ nil,	  "    c := catalog.stkDepth();"		  ]
[ nil,	  "    system.printf(\"depth %d\\n\",c);"	  ]
[ nil,	  "    t := catalog.stkFrame();"		  ]
[ nil,	  "    io.print(t);"				  ]
[ nil,	  "    d := catalog.symbolDump();"		  ]
[ nil,	  "    io.print(d);"				  ]
[ nil,	  "    t := catalog.stkFrame(c);"		  ]
[ nil,	  "    io.print(t);"				  ]
[ nil,	  "    v := catalog.varUsed();"			  ]
[ nil,	  "    io.print(v);"				  ]
[ nil,	  "    w := catalog.varConstant();"		  ]
[ nil,	  "    io.print(w);"				  ]
[ nil,	  "end test;"					  ]
#-------------------------#
# BAT:	  frame		  #
# (str)	  (str)		  #
#-------------------------#
[ "test", "0@0"		  ]
[ "age",  "0"		  ]
[ "nme",  "12"		  ]
[ "$3",	  "\"jj\""	  ]
#-----------------#
# BAT:	  used	  #
# (str)	  (void)  #
#-----------------#
[ "age",  nil	  ]
[ "nme",  nil	  ]
[ "$4",	  nil	  ]
[ "c",	  nil	  ]
[ "$7",	  nil	  ]
[ "t",	  nil	  ]
[ "d",	  nil	  ]
[ "v",	  nil	  ]
[ "w",	  nil	  ]
#-------------------------#
# BAT:	  constant	  #
# (str)	  (void)	  #
#-------------------------#
[ "$4",	  nil		  ]
[ "$7",	  nil		  ]
>