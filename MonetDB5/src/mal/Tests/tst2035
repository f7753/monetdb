#The 2000 serie  is focussed on parallelism

function clkticks(n:int):void;
barrier	b:= n>0;
	printf("clock tick %d\n",n);
	alarm.sleep(5);
	n:= n-1;
	redo b;
exit	b;
end clkticks;

thread 	hdl:=0;	# synchronize through a counter
	clkticks(1);
	hdl:= hdl+1;
	printf("hdl %d\n",hdl);
barrier t:= hdl==2;
	leave hdl;
exit	t;
	printf("Redo thread\n");
	redo hdl;
exit	hdl;

printf("Main thread\n");
# loop to wait for the child to exit
barrier wl:= true;
	printf("Wait for child to exit %d\n",hdl);
barrier	t0:=hdl == 2;
	printf("Child died \n");
	leave wl;
exit	t0;
	alarm.sleep(1);
	redo wl;
exit	wl;
