# Mil compiler Version 1.0)
# Copyright (c) 1993-2001, CWI. All rights reserved.

# Predefined code segment
#use "mal/iterator";		CAUSES an ERROR!!
	_v0:= calc.oid(20000000);
	_v1:= calc.setoid(_v0);
#setoid(oid(20000000));
##test basic functionality of the BAT library.
##focussed on strings
##it includes bat.insertions,deletions,selections, and joins.
#
	_v2:= bbp.new(:str,:int);
	b := _v2;
#b:= new(str,int);
	_v3:= bat.insert(b,"the",1);
#b.insert("the",1);
	_v4:= bat.insert(b,"quick",2);
#b.insert("quick",2);
	_v5:= bat.insert(b,"brown",3);
#b.insert("brown",3);
	_v6:= bat.insert(b,"fox",4);
#b.insert("fox",4);
	_v7:= bat.insert(b,"jumps",5);
#b.insert("jumps",5);
	_v8:= bat.insert(b,"over",6);
#b.insert("over",6);
	_v9:= bat.insert(b,"lazy",7);
#b.insert("lazy",7);
	_v10:= bat.insert(b,"dog",8);
#b.insert("dog",8);
	_v11:= calc.str(nil);
	_v12:= bat.insert(b,_v11,9);
#b.insert(str(nil),9);
	_v13:= bat.insert(b,".",10);
#b.insert(".",10);
	_v14:= calc.int(nil);
	_v15:= bat.insert(b,"",_v14);
#b.insert("",int(nil));
	_v16:= calc.str(nil);
	_v17:= calc.int(nil);
	_v18:= bat.insert(b,_v16,_v17);
#b.insert(str(nil),int(nil));
	_v19:= io.print(b);
#b.print;
#
#
## Testing simple retrievals
	_v20:= algebra.find(b,"the");
	_v21:= io.print(_v20);
#b.find("the").print;
	_v22:= algebra.find(b,"fox");
	_v23:= io.print(_v22);
#b.find("fox").print;
	_v24:= calc.str(nil);
	_v25:= algebra.find(b,_v24);
	_v26:= io.print(_v25);
#b.find(str(nil)).print;
## This should cause an error
	_v27:= algebra.find(b,"cat");
	_v28:= io.print(_v27);
catch MALexception;
	io.print(MALexception);
exit  MALexception;
#b.find("cat").print;
#
## Can we bat.delete them and re-insert them later on
	_v29:= bat.delete(b,"fox",4);
#b.delete("fox",4);
	_v30:= bat.delete(b,"the",1);
#b.delete("the",1);
	_v31:= bat.delete(b,".",10);
#b.delete(".",10);
	_v32:= io.print(b);
#b.print;
#
	_v33:= bat.insert(b,"fox",4);
#b.insert("fox",4);
	_v34:= bat.insert(b,"the",1);
#b.insert("the",1);
	_v35:= bat.insert(b,".",10);
#b.insert(".",10);
	_v36:= algebra.count(b);
	_v37:= io.print(_v36);
#b.count.print;
#
## Lets cut out a few sections
	_v38:= algebra.select(b,2,4);
	_v39:= io.print(_v38);
#b.select(2,4).print;
	_v40:= calc.int(nil);
	_v41:= algebra.select(b,7,_v40);
	_v42:= io.print(_v41);
#b.select(7,int(nil)).print;
	_v43:= calc.int(nil);
	_v44:= calc.int(nil);
	_v45:= algebra.select(b,_v43,_v44);
	_v46:= io.print(_v45);
#b.select(int(nil),int(nil)).print;
#
## A 2-dimensional cut
	_v47:= algebra.fragment(b,"fox","quick",1,5);
	bns := _v47;
	_v48:= io.print(bns);
#bns:=b.fragment("fox","quick",1,5);bns.print;
	_v49:= calc.str(nil);
	_v50:= algebra.fragment(b,"fox",_v49,1,5);
	_v51:= io.print(_v50);
#b.fragment("fox",str(nil),1,5).print;
	_v52:= calc.str(nil);
	_v53:= calc.int(nil);
	_v54:= calc.int(nil);
	_v55:= algebra.fragment(b,"fox",_v52,_v53,_v54);
	_v56:= io.print(_v55);
#b.fragment("fox",str(nil),int(nil),int(nil)).print;
	_v57:= calc.str(nil);
	_v58:= calc.int(nil);
	_v59:= calc.int(nil);
	_v60:= algebra.fragment(b,_v57,"f",_v58,_v59);
	_v61:= io.print(_v60);
#b.fragment(str(nil),"f",int(nil),int(nil)).print;
	_v62:= bat.reverse(b);
	_v63:= calc.int(nil);
	_v64:= calc.int(nil);
	_v65:= calc.str(nil);
	_v66:= algebra.fragment(_v62,_v63,_v64,_v65,"f");
	_v67:= io.print(_v66);
#b.reverse.fragment(int(nil),int(nil),str(nil),"f").print;
#
	_v68:= bat.reverse(bns);
	_v69:= algebra.join(b,_v68);
	bnj := _v69;
#bnj:= b.join(bns.reverse);
	_v70:= io.print(bnj);
#bnj.print;
#
	_v71:= bat.reverse(bnj);
	_v72:= algebra.semijoin(b,_v71);
	bnk := _v72;
#bnk:= b.semijoin(bnj.reverse);
	_v73:= io.print(bnk);
#bnk.print;
#
## testing the algebra.like command
	_v74:= bat.reverse(b);
	_v75:= algebra.like(_v74,"ox");
	_v76:= io.print(_v75);
#b.reverse.like("ox").print;
	_v77:= bat.reverse(b);
	_v78:= algebra.like(_v77,"fo");
	_v79:= io.print(_v78);
#b.reverse.like("fo").print;
	_v80:= bat.reverse(b);
	_v81:= algebra.like(_v80,"fox");
	_v82:= io.print(_v81);
#b.reverse.like("fox").print;
	_v83:= bat.reverse(b);
	_v84:= algebra.like(_v83," fox");
	_v85:= io.print(_v84);
#b.reverse.like(" fox").print;
#quit;
