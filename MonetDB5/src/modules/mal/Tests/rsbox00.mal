include rsbox;

rs := rsbox.create("lost");
rs := rsbox.create("myid");

b1 := bbp.new(:void, :str);
bat.insert(b1, nil, "test1");
bat.insert(b1, nil, "test2");
bat.insert(b1, nil, nil:str);

resultset.addColumn(rs, b1, "col1");
resultset.setProperty(rs, "name", "table1");
resultset.setProperty(rs, "schema", "sys");

b2 := bbp.new(:void, :int);
bat.insert(b2, nil, 2);
bat.insert(b2, nil, nil:int);
bat.insert(b2, nil, 5);

resultset.addColumn(rs, b2, "col2");
resultset.setProperty(rs, "width", 1);
resultset.setProperty(rs, "name", "table2");
resultset.setProperty(rs, "schema", "sys");

resultset.setComplete(rs);

resultset.writeNextPart(rs);

io.print("Before any cleanup:");
barrier (v,res) := rsbox.newIterator();
	io.print(res);
redo (v,res) := rsbox.hasMoreElements();
exit v;

rsbox.release(rs);

io.print("After release of 'myid':");
barrier (v,res) := rsbox.newIterator();
	io.print(res);
redo (v,res) := rsbox.hasMoreElements();
exit v;

rsbox.releaseAll();

io.print("After a releaseAll:");
barrier (v,res) := rsbox.newIterator();
	io.print(res);
redo (v,res) := rsbox.hasMoreElements();
exit v;

# we did not open, it so why close it?
#rsbox.close();
