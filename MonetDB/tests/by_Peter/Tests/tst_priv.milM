# test change of private mmap -> malloced under extends
new(void,str,1000000).persists(true).access(BAT_WRITE).rename("a");
d := new(void,int,1000);
i := 0;
while(i < 1000) d.insert(nil,i :+= 1);
d := [str](d).seqbase(0@0);
a.seqbase(0@0).insert(d);

i := 0;
while(i < 100) {
    a.insert(d.seqbase(oid(a.count())));
    i :+= 1;
}

a.mmap(1,1,1,1,1);
unload("a");
a.info.reverse.select("theap.storage").reverse.print;

[int](a.mirror);
e := [str]([int](a.mirror));
debugmask(49);
a.insert(e);
debugmask(9);

#a.mmap(1,1,1,1,1);
a.info.reverse.select("theap.storage").reverse.print;
e := [str]([int](a.mirror));
debugmask(49);
a.insert(e);
debugmask(9);

a.info.reverse.select("theap.storage").reverse.print;
a.insert(nil,"make dirty..");
commit;

a.destroy;
commit;

quit;
