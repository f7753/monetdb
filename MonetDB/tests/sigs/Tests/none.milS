setoid(20000000);

PROC mmn() : BAT[oid,str] {
	 return(monet_mod_nme.kdiff(monet_mod_nme.[startsWith]("_").uselect(true)));
}

loaded();
[~mmn()].reverse().sort().print();
[~view_modules].reverse().kunique().sort().print();

module("cluster");
loaded();
[~mmn()].reverse().sort().print();

# # module("Meta");
# # loaded;
# # [~mmn()].reverse.sort.print;

fix:=mmn().reverse().copy();
[fix~].print();

others:=kdiff(view_modules.reverse().kunique(),mmn().reverse()).sort().access(BAT_WRITE).revert();
[others~].print();

others@batloop(){
	printf("\n\tloading %s\n\n",$h);
	module($h);
	loaded();
	off:=kdiff(mmn().reverse,fix);
	[off~].print();
	off@batloop(){
		printf("\n\tdropping %s\n\n",$h);
	}
	drop($h);
	loaded();
}
quit();
