@echo off

if not "%1"=="" goto skip
call %0 -r
goto end

:skip

set builddir=@MONET_BUILD@
set srcdir=@MONET_SOURCE@

set MOD_PATH=%builddir%\src\modules\plain\.libs;%builddir%\src\modules\contrib\.libs;%builddir%\src\modules\calibrator\.libs;%builddir%\src\mapi\.libs

set PATH=%builddir%\src\testing;%builddir%\src\tools;%builddir%\src\mapi\clients;%PATH%
set PYTHONPATH=%builddir%\src\testing;%srcdir%\src\testing;%builddir%\src\common;%srcdir%\src\mapi\clients
set PATH=%MOD_PATH%;%builddir%\src\common;%builddir%\src\gdk;%builddir%\src\mapi\clients;%builddir%\src\modules\plain\stream;%builddir%\src\monet;%PATH%

REM execute Mtest.py in the source directory
cd %srcdir%

call python "%builddir%\src\testing\Mtest.py" "--monet_mod_path=%MOD_PATH%" "--config=%builddir%\conf\monet.conf" "--dbfarm=%builddir%\dbfarm" "--sql_logdir=%builddir%\log" "--TSTTRGBASE=%builddir%" %*

:end
