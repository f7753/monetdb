#!/usr/bin/env python
# The contents of this file are subject to the MonetDB Public
# License Version 1.0 (the "License"); you may not use this file
# except in compliance with the License. You may obtain a copy of
# the License at 
# http://monetdb.cwi.nl/Legal/MonetDBLicense-1.0.html
# 
# Software distributed under the License is distributed on an "AS
# IS" basis, WITHOUT WARRANTY OF ANY KIND, either express or
# implied. See the License for the specific language governing
# rights and limitations under the License.
# 
# The Original Code is the Monet Database System.
# 
# The Initial Developer of the Original Code is CWI.
# Portions created by CWI are Copyright (C) 1997-2002 CWI.  
# All Rights Reserved.
# 
# Contributor(s):
# 		Martin Kersten <Martin.Kersten@cwi.nl>
# 		Peter Boncz <Peter.Boncz@cwi.nl>
# 		Niels Nes <Niels.Nes@cwi.nl>
# 		Stefan Manegold  <Stefan.Manegold@cwi.nl>

import sys
import os

if os.environ.has_key('MONET_PREFIX'):
    sys.path.append(os.environ['MONET_PREFIX']+os.sep+'share'+os.sep+'MonetDB'+os.sep+'python')
else:
    sys.path.append('@Qprefix@'+os.sep+'share'+os.sep+'@PACKAGE@'+os.sep+'python')

import monet_options
from Mapi import *

import fileinput

cmd_options = [
    ('host',None,'host','hostname','host to connect to (default: localhost)'),
    ('port',None,'mapi_port','port','port to connect to (default: 50000)'),
    ]

try:
    opt, args = monet_options.parse_options(sys.argv[1:], cmd_options)
except monet_options.Error:
    # error parsing options
    sys.exit(1)

s = server( opt.get("host","localhost"), int(opt.get("mapi_port",50000)), environ['USER'])
print("#MapiClient (python) connected to %s:%d as %s" % (opt.get("host","localhost"), int(opt.get("mapi_port",50000)), environ['USER']))

#fi = fileinput.FileInput()
fi = sys.stdin

sys.stdout.write( s.prompt )
line= fi.readline()
while( line != "quit;\n" ):
    res = s.cmd( line )
    print(res);
    sys.stdout.write( s.prompt )
    line = fi.readline()

s.disconnect()
