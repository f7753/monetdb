@f Mshutdown
@a St. Manegold
@v 0.1
@* Monet Database Shutdown Utility
@+ Manual Page
@T
The {\tt Mshutdown} utility is designed to shutdown a Mserver running in the
background.

@- Usage
@T
\begin{verbatim}
Mshudown [-d<debug level>] [-port <host:port>]
\end{verbatim}

The program uses the Mapi interface.
@{
@+ Implementation
@c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include "Mapi.h"

int	debug;
char 	*address;
Msession   mid;

void usage() {
	printf("usage: Mshutdown [-d<debug level>] [-port <host:port>]\n");
	exit(1);
}

int main(int argc, char** argv) {
	int i;
	char *rtrn;
	char *s;

	address = getenv("MONETPORT");
        for(i = 1; i < argc; i++) 
	if (argv[i][0] == '-') {
		switch(argv[i][1]) {
		case 'd':
			debug++;
			break;
		case 'p':
			if (strcmp(argv[i], "-port") == 0) {
				address = argv[++i];
				break;
			}
		default:
			fprintf(stderr,
			"unknown argument:%s\n", argv[i]);
			usage();
		}
	} else {
		usage();
	}

	if( address == 0 ) address = strdup("localhost:50000");
	s = (char *) strchr(address,':');
	if( s == 0 ){
		printf("address syntax error: %s\n", address);
		exit(1);
	}
	*s = 0;
	i = atoi(s+1);
	if( *address == 0 ) address = 0;
	mid = Mconnect(address,i,0,0);
	if( Merror(mid)) {
		Mexplain(mid,stdout);
		exit(1);
	}
	mid->trace = debug;

	if( Mdorequest(mid,"shutdown;\n") || Merror( mid ) ){
		Mexplain(mid,stdout);
	}
	while(rtrn=Mgetreply(mid)){
		printf("%s\n",rtrn);
	}
	if( Merror(mid) ){
		Mexplain(mid,stdout);
	}

        Mdisconnect(mid);
	printf("# shutdown finished\n");
	return 0;
}
@}
